<?xml version="1.0" encoding="utf-8" ?>
<Migration>
  <Up>
    <Statement>
      <![CDATA[
        -- w2_Order
        DECLARE @TABLE_NAME NVARCHAR(256)
        DECLARE @COLUMN_NAME NVARCHAR(256)
        DECLARE @TABLE_ID INTEGER 
        DECLARE @COLUMN_ID INTEGER 
        DECLARE @CONSTRAINT_NAME NVARCHAR(256)
        SET @TABLE_NAME = 'w2_Order'
        SET @COLUMN_NAME = 'card_3dsecure_auth_url'

        --削除したいテーブルのシステムidを取得する
        SELECT @TABLE_ID = id FROM sys.sysobjects 
        WHERE xtype = 'U' AND name = @TABLE_NAME

        --削除したいカラムのシステムidを取得する
        SELECT @COLUMN_ID = column_id FROM sys.columns 
        WHERE object_id = @TABLE_ID AND name = @COLUMN_NAME

        --削除したい制約名を取得する
        SELECT @CONSTRAINT_NAME = name FROM sys.sysobjects 
        WHERE id = (SELECT constid FROM sys.sysconstraints WHERE id = @TABLE_ID AND colid = @COLUMN_ID)

        --確認 => テーブル->制約->制約名->制約をスクリプト化であっているか確認できます。
        SELECT @CONSTRAINT_NAME

        --制約を削除する
        EXEC('ALTER TABLE '+ @TABLE_NAME + ' DROP CONSTRAINT ' + @CONSTRAINT_NAME)

        ALTER TABLE [w2_Order] ALTER COLUMN [card_3dsecure_auth_url] [nvarchar] (MAX) NOT NULL;
        ALTER TABLE [w2_Order] ADD DEFAULT (N'') FOR [card_3dsecure_auth_url] ;
        GO
      ]]>
    </Statement>
  </Up>
</Migration>