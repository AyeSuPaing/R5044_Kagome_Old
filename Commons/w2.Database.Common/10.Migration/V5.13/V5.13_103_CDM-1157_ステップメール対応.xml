<?xml version="1.0" encoding="utf-8" ?>
<Migration>
	<Up>
		<Statement>
			<![CDATA[
IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'w2_MailDistSetting' AND COLUMN_NAME = 'enable_deduplication')
ALTER TABLE w2_MailDistSetting ADD enable_deduplication NVARCHAR(2) NOT NULL DEFAULT N'0'
GO

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'w2_MailDistSetting' AND COLUMN_NAME = 'last_duplicate_except_count')
ALTER TABLE w2_MailDistSetting ADD last_duplicate_except_count BIGINT
GO

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'w2_MailDistSentUser')
BEGIN
    CREATE TABLE [dbo].[w2_MailDistSentUser] (
	    [maildist_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	    [user_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	    [date_created] [datetime] NOT NULL DEFAULT (getdate()),
	    [date_changed] [datetime] NOT NULL DEFAULT (getdate()),
	    [last_changed] [nvarchar] (20) NOT NULL DEFAULT (N'')
    ) ON [PRIMARY]

    ALTER TABLE [dbo].[w2_MailDistSentUser] WITH NOCHECK ADD
	    CONSTRAINT [PK_w2_MailDistSentUser] PRIMARY KEY  CLUSTERED
	    (
		    [maildist_id],
		    [user_id]
	    ) ON [PRIMARY]
END
			]]>
		</Statement>
	</Up>
</Migration>