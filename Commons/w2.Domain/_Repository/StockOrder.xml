<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : 発注入庫系SQLステートメントXML(StockOrder.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright W2 Co.,Ltd. 2021 All Rights Reserved.
=========================================================================================================
-->
<StockOrder>

  <!-- 発注情報一覧(CSV出力用) -->
  <GetStockOrderMaster>
    <Statement>
      <![CDATA[
        SELECT  @@ fields @@
          FROM  w2_StockOrder
                [[ STOCKORDER_SEARCH_WHERE ]]
                [[ STOCKORDER_SEARCH_ORDER_BY ]]
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="stock_order_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="relation_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="product_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="order_status" Type="nvarchar" Size="10" />
      <Input Name="delivery_status" Type="nvarchar" Size="10" />
      <Input Name="order_date_from" Type="datetime" />
      <Input Name="order_date_to" Type="datetime" />
      <Input Name="delivery_date_from" Type="datetime" />
      <Input Name="delivery_date_to" Type="datetime" />
      <Input Name="sort_kbn" Type="nvarchar" Size="10" />
    </Parameter>
  </GetStockOrderMaster>

  <!-- 発注商品情報一覧(CSV出力用) -->
  <GetStockOrderItemMaster>
    <Statement>
      <![CDATA[
        SELECT  @@ fields @@
          FROM  w2_StockOrder
                INNER JOIN w2_StockOrderItem ON
                (
                  w2_StockOrder.shop_id = w2_StockOrderItem.shop_id
                  AND
                  w2_StockOrder.stock_order_id = w2_StockOrderItem.stock_order_id
                )
                INNER JOIN w2_ProductView ON
                (
                  w2_StockOrderItem.shop_id = w2_ProductView.shop_id
                  AND
                  w2_StockOrderItem.product_id = w2_ProductView.product_id
                  AND
                  w2_StockOrderItem.variation_id = w2_ProductView.variation_id
                )                
                [[ STOCKORDER_SEARCH_WHERE ]]
                [[ STOCKORDER_SEARCH_ORDER_BY ]]
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="stock_order_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="relation_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="product_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="order_status" Type="nvarchar" Size="10" />
      <Input Name="delivery_status" Type="nvarchar" Size="10" />
      <Input Name="order_date_from" Type="datetime" />
      <Input Name="order_date_to" Type="datetime" />
      <Input Name="delivery_date_from" Type="datetime" />
      <Input Name="delivery_date_to" Type="datetime" />
      <Input Name="sort_kbn" Type="nvarchar" Size="10" />
    </Parameter>
  </GetStockOrderItemMaster>

  <!-- 発注マスタフィールドチェック -->
  <CheckStockOrderFields>
    <Statement>
      <![CDATA[
          SELECT  TOP 1
                  @@ fields @@
            FROM  w2_StockOrder
           WHERE  w2_StockOrder.shop_id = @shop_id 
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </CheckStockOrderFields>

  <!-- 発注商品マスタフィールドチェック -->
  <CheckStockOrderItemFields>
    <Statement>
      <![CDATA[
          SELECT  TOP 1
                  @@ fields @@
            FROM  w2_StockOrder,
                  w2_StockOrderItem
           WHERE  w2_StockOrder.shop_id = @shop_id 
             AND  w2_StockOrder.shop_id = w2_StockOrderItem.shop_id
             AND  w2_StockOrder.stock_order_id = w2_StockOrderItem.stock_order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </CheckStockOrderItemFields>

</StockOrder>