<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : ノベルティ設定系SQLステートメントXML (Novelty.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright W2 Co.,Ltd. 2015 All Rights Reserved.
=========================================================================================================
-->
<Novelty>

  <!-- 検索ヒット件数取得 -->
  <GetSearchHitCount>
    <Statement>
      <![CDATA[
        SELECT  COUNT(*)
          FROM  w2_Novelty
                [[ NOVELTY_SEARCH_WHERE ]]
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="novelty_disp_name_like_escaped" Type="nvarchar" Size="200" />
      <Input Name="novelty_name_like_escaped" Type="nvarchar" Size="200" />
      <Input Name="status" Type="nvarchar" Size="20"/>
    </Parameter>
  </GetSearchHitCount>

  <!-- 検索 -->
  <Search>
    <Statement>
      <![CDATA[
        SELECT  w2_Novelty.*
          FROM  (
                  SELECT  w2_Novelty.shop_id,
                          w2_Novelty.novelty_id,
                          ROW_NUMBER()
                          OVER
                          (
                            [[ NOVELTY_SEARCH_ORDER_BY ]]
                          ) AS row_num
                    FROM  w2_Novelty
                          [[ NOVELTY_SEARCH_WHERE ]]
                ) AS RowIndex
                INNER JOIN w2_Novelty ON
                (
                  RowIndex.shop_id = w2_Novelty.shop_id
                  AND
                  RowIndex.novelty_id = w2_Novelty.novelty_id
                )
         WHERE  @bgn_row_num <= RowIndex.row_num
           AND  RowIndex.row_num <= @end_row_num
      ORDER BY  RowIndex.row_num ASC
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id_like_escaped" Type="nvarchar" Size="60" />
      <Input Name="novelty_disp_name_like_escaped" Type="nvarchar" Size="200" />
      <Input Name="novelty_name_like_escaped" Type="nvarchar" Size="200" />
      <Input Name="status" Type="nvarchar" Size="20"/>
      <Input Name="sort_kbn" Type="nvarchar" Size="2"/>
      <Input Name="bgn_row_num" Type="int" />
      <Input Name="end_row_num" Type="int" />
    </Parameter>
  </Search>

  <!-- 取得 -->
  <Get>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_Novelty
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </Get>

  <!-- 取得（全件） -->
  <GetAll>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_Novelty
         WHERE  w2_Novelty.shop_id = @shop_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetAll>

  <!-- 登録 -->
  <Insert>
    <Statement>
      <![CDATA[
        INSERT  w2_Novelty
                (
                  shop_id
                  ,novelty_id
                  ,novelty_disp_name
                  ,novelty_name
                  ,discription
                  ,date_begin
                  ,date_end
                  ,valid_flg
                  ,date_created
                  ,date_changed
                  ,last_changed
                  ,auto_additional_flg
                )
        VALUES  (
                  @shop_id
                  ,@novelty_id
                  ,@novelty_disp_name
                  ,@novelty_name
                  ,@discription
                  ,@date_begin
                  ,@date_end
                  ,@valid_flg
                  ,GETDATE()
                  ,GETDATE()
                  ,@last_changed
                  ,@auto_additional_flg
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
      <Input Name="novelty_disp_name" Type="nvarchar" Size="100" />
      <Input Name="novelty_name" Type="nvarchar" Size="100" />
      <Input Name="discription" Type="nvarchar" Size="MAX" />
      <Input Name="date_begin" Type="datetime" />
      <Input Name="date_end" Type="datetime" />
      <Input Name="valid_flg" Type="nvarchar" Size="1" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
      <Input Name="auto_additional_flg" Type="nvarchar" Size="1" />
    </Parameter>
  </Insert>

  <!-- 更新 -->
  <Update>
    <Statement>
      <![CDATA[
        UPDATE  w2_Novelty
           SET  novelty_disp_name = @novelty_disp_name
                ,novelty_name = @novelty_name
                ,discription = @discription
                ,date_begin = @date_begin
                ,date_end = @date_end
                ,valid_flg = @valid_flg
                ,date_changed = GETDATE()
                ,last_changed = @last_changed
                ,auto_additional_flg = @auto_additional_flg
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
      <Input Name="novelty_disp_name" Type="nvarchar" Size="100" />
      <Input Name="novelty_name" Type="nvarchar" Size="100" />
      <Input Name="discription" Type="nvarchar" Size="MAX" />
      <Input Name="date_begin" Type="datetime" />
      <Input Name="date_end" Type="datetime" />
      <Input Name="valid_flg" Type="nvarchar" Size="1" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
      <Input Name="auto_additional_flg" Type="nvarchar" Size="1" />
    </Parameter>
  </Update>

  <!-- 削除 -->
  <Delete>
    <Statement>
      <![CDATA[
        DELETE  w2_Novelty
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </Delete>

  <!-- 対象アイテム取得（全て） -->
  <GetTargetItemAll>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_NoveltyTargetItem
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetTargetItemAll>

  <!-- 対象アイテム登録 -->
  <InsertTargetItem>
    <Statement>
      <![CDATA[
        INSERT  w2_NoveltyTargetItem
                (
                  shop_id
                  ,novelty_id
                  ,novelty_target_item_no
                  ,novelty_target_item_type
                  ,novelty_target_item_value
                  ,novelty_target_item_type_sort_no
                  ,date_created
                  ,date_changed
                  ,last_changed
                )
        VALUES  (
                  @shop_id
                  ,@novelty_id
                  ,@novelty_target_item_no
                  ,@novelty_target_item_type
                  ,@novelty_target_item_value
                  ,@novelty_target_item_type_sort_no
                  ,GETDATE()
                  ,GETDATE()
                  ,@last_changed
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
      <Input Name="novelty_target_item_no" Type="int" />
      <Input Name="novelty_target_item_type" Type="nvarchar" Size="30" />
      <Input Name="novelty_target_item_value" Type="nvarchar" Size="max" />
      <Input Name="novelty_target_item_type_sort_no" Type="int" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </InsertTargetItem>

  <!-- 対象アイテム削除（全て） -->
  <DeleteTargetItemAll>
    <Statement>
      <![CDATA[
        DELETE  w2_NoveltyTargetItem
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteTargetItemAll>

  <!-- 付与条件取得（全て） -->
  <GetGrantConditionsAll>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_NoveltyGrantConditions
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetGrantConditionsAll>

  <!-- 付与条件登録 -->
  <InsertGrantConditions>
    <Statement>
      <![CDATA[
        INSERT  w2_NoveltyGrantConditions
                (
                  shop_id
                  ,novelty_id
                  ,condition_no
                  ,user_rank_id
                  ,amount_begin
                  ,amount_end
                  ,date_created
                  ,date_changed
                  ,last_changed
                )
        VALUES  (
                  @shop_id
                  ,@novelty_id
                  ,@condition_no
                  ,@user_rank_id
                  ,@amount_begin
                  ,@amount_end
                  ,GETDATE()
                  ,GETDATE()
                  ,@last_changed
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
      <Input Name="condition_no" Type="int" />
      <Input Name="user_rank_id" Type="nvarchar" Size="30" />
      <Input Name="amount_begin" Type="decimal" Size="18,3" />
      <Input Name="amount_end" Type="decimal" Size="18,3" />
      <Input Name="date_created" Type="datetime" />
      <Input Name="date_changed" Type="datetime" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </InsertGrantConditions>

  <!-- 付与条件削除（全て） -->
  <DeleteGrantConditionsAll>
    <Statement>
      <![CDATA[
        DELETE  w2_NoveltyGrantConditions
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteGrantConditionsAll>

  <!-- 付与アイテム取得（全て） -->
  <GetGrantItemAll>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_NoveltyGrantItem
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetGrantItemAll>

  <!-- 付与アイテム登録 -->
  <InsertGrantItem>
    <Statement>
      <![CDATA[
        INSERT  w2_NoveltyGrantItem
                (
                  shop_id
                  ,novelty_id
                  ,condition_no
                  ,product_id
                  ,sort_no
                  ,date_created
                  ,date_changed
                  ,last_changed
                )
        VALUES  (
                  @shop_id
                  ,@novelty_id
                  ,@condition_no
                  ,@product_id
                  ,@sort_no
                  ,GETDATE()
                  ,GETDATE()
                  ,@last_changed
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
      <Input Name="condition_no" Type="int" />
      <Input Name="product_id" Type="nvarchar" Size="max" />
      <Input Name="sort_no" Type="int" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </InsertGrantItem>

  <!-- 付与アイテム削除（全て） -->
  <DeleteGrantItemAll>
    <Statement>
      <![CDATA[
        DELETE  w2_NoveltyGrantItem
         WHERE  shop_id = @shop_id
           AND  novelty_id = @novelty_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteGrantItemAll>  

</Novelty>