<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : メッセージ系SQLステートメントXML(CsMessage.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright w2solution Co.,Ltd. 2013 All Rights Reserved.
=========================================================================================================
-->
<CsMessage>
  
  <!-- 登録用メッセージNO取得 -->
  <GetRegisterMessageNo>
    <Statement>
      <![CDATA[
        SELECT  ISNULL(MAX(message_no),0) + 1 AS message_no
          FROM  w2_CsMessage
         WHERE  w2_CsMessage.dept_id = @dept_id
           AND  w2_CsMessage.incident_id = @incident_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="dept_id" Type="nvarchar" Size="30" />
      <Input Name="incident_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetRegisterMessageNo>

  <!-- 登録 -->
  <Register>
    <Statement>
      <![CDATA[
        INSERT  w2_CsMessage
                (
                  dept_id,
                  incident_id,
                  message_no,
                  media_kbn,
                  direction_kbn,
                  operator_id,
                  message_status,
                  user_name1,
                  user_name2,
                  user_name_kana1,
                  user_name_kana2,
                  user_mail_addr,
                  user_tel1,
                  inquiry_title,
                  inquiry_text,
                  reply_text,
                  receive_mail_id,
                  send_mail_id,
                  valid_flg,
                  date_created,
                  date_changed,
                  last_changed
                )
        VALUES  (
                  @dept_id,
                  @incident_id,
                  @message_no,
                  @media_kbn,
                  @direction_kbn,
                  @operator_id,
                  @message_status,
                  @user_name1,
                  @user_name2,
                  @user_name_kana1,
                  @user_name_kana2,
                  @user_mail_addr,
                  @user_tel1,
                  @inquiry_title,
                  @inquiry_text,
                  @reply_text,
                  @receive_mail_id,
                  @send_mail_id,
                  @valid_flg,
                  GETDATE(),
                  GETDATE(),
                  @last_changed
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="dept_id" Type="nvarchar" Size="30" />
      <Input Name="incident_id" Type="nvarchar" Size="30" />
      <Input Name="message_no" Type="int" />
      <Input Name="media_kbn" Type="nvarchar" Size="10" />
      <Input Name="direction_kbn" Type="nvarchar" Size="10" />
      <Input Name="operator_id" Type="nvarchar" Size="20" />
      <Input Name="message_status" Type="nvarchar" Size="10" />
      <Input Name="user_name1" Type="nvarchar" Size="20" />
      <Input Name="user_name2" Type="nvarchar" Size="20" />
      <Input Name="user_name_kana1" Type="nvarchar" Size="30" />
      <Input Name="user_name_kana2" Type="nvarchar" Size="30" />
      <Input Name="user_mail_addr" Type="nvarchar" Size="256" />
      <Input Name="user_tel1" Type="nvarchar" Size="16" />
      <Input Name="inquiry_title" Type="nvarchar" Size="50" />
      <Input Name="inquiry_text" Type="nvarchar" Size="max" />
      <Input Name="reply_text" Type="nvarchar" Size="max" />
      <Input Name="receive_mail_id" Type="nvarchar" Size="10" />
      <Input Name="send_mail_id" Type="nvarchar" Size="10" />
      <Input Name="valid_flg" Type="nvarchar" Size="10" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </Register>

</CsMessage>
