<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : 商品マスタ系SQLステートメントXML (Product.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright w2solution Co.,Ltd. 2017 All Rights Reserved.
=========================================================================================================
-->
<Product>

  <!-- 商品情報取得 -->
  <GetRecommendProduct>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_Product
         WHERE  shop_id = @shop_id
           AND  display_from <= GETDATE()
           AND  ((display_to IS NULL) OR (display_to >= GETDATE()))
           AND  display_kbn = '0'
           AND  mobile_disp_flg IN ('0','1')
           AND  valid_flg = '1'
           AND  use_recommend_flg = '1'
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetRecommendProduct>

  <!-- 商品カテゴリ情報取得 -->
  <GetRecommendCategory>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_ProductCategory
         WHERE  shop_id = @shop_id
           AND  valid_flg = '1'
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetRecommendCategory>

  <!-- 商品ブランド情報取得 -->
  <GetProductBrand>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_ProductBrand
         WHERE  brand_id = @brand_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="brand_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetProductBrand>

  <!-- 連携用商品IDの更新 -->
  <UpdateRecommendProductId>
    <Statement>
      <![CDATA[
        UPDATE  w2_Product
           SET  recommend_product_id = @recommend_product_id,
                date_changed = GETDATE()
         WHERE  shop_id = @shop_id
           AND  product_id = @product_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="product_id" Type="nvarchar" />
      <Input Name="recommend_product_id" Type="nvarchar" />
    </Parameter>
  </UpdateRecommendProductId>

</Product>
