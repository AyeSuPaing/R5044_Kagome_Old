<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : 商品系SQLステートメントXML(Product.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright w2solution Co.,Ltd. 2009 All Rights Reserved.
=========================================================================================================
-->
<Product>

  <!-- 商品ビュー取得 -->
  <GetProductView>
    <Statement>
      <![CDATA[
        SELECT  *,
		            w2_ProductCategory1.name category_name1,
		            w2_ProductCategory2.name category_name2,
		            w2_ProductCategory3.name category_name3,
		            w2_ProductCategory4.name category_name4,
                w2_ProductCategory5.name category_name5,
                w2_ProductTag.*
          FROM  w2_ProductView
                INNER JOIN w2_Product ON    -- 抽出条件用に加える
                (
                  w2_Product.shop_id = w2_ProductView.shop_id
                  AND
                  w2_Product.product_id = w2_ProductView.product_id
                )
		            LEFT JOIN w2_ProductCategory w2_ProductCategory1
			            ON w2_ProductView.category_id1 = w2_ProductCategory1.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory2
			            ON w2_ProductView.category_id2 = w2_ProductCategory2.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory3
			            ON w2_ProductView.category_id3 = w2_ProductCategory3.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory4
			            ON w2_ProductView.category_id4 = w2_ProductCategory4.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory5
			            ON w2_ProductView.category_id5 = w2_ProductCategory5.category_id
                LEFT JOIN w2_ProductTag ON
                (
                  w2_Product.product_id = w2_ProductTag.product_id
                )
         WHERE  w2_ProductView.shop_id = @shop_id
           AND  (@@ extractionPattern @@)
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetProductView>

  <!-- 商品拡張項目取得 -->
  <GetProductExtend>
    <Statement>
      <![CDATA[
        SELECT  *
          FROM  w2_ProductExtend
                INNER JOIN w2_Product ON    -- 抽出条件用に加える
                (
                  w2_Product.shop_id = w2_ProductExtend.shop_id
                  AND
                  w2_Product.product_id = w2_ProductExtend.product_id
                )
         WHERE  w2_ProductExtend.shop_id = @shop_id
           AND  (@@ extractionPattern @@)
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetProductExtend>

  <!-- 商品情報取得 -->
  <GetProduct>
    <Statement>
      <![CDATA[
        SELECT  w2_Product.*,
                w2_ProductExtend.extend1,
                w2_ProductExtend.extend2,
                w2_ProductExtend.extend3,
                w2_ProductExtend.extend4,
                w2_ProductExtend.extend5,
                w2_ProductExtend.extend6,
                w2_ProductExtend.extend7,
                w2_ProductExtend.extend8,
                w2_ProductExtend.extend9,
                w2_ProductExtend.extend10,
                w2_ProductExtend.extend11,
                w2_ProductExtend.extend12,
                w2_ProductExtend.extend13,
                w2_ProductExtend.extend14,
                w2_ProductExtend.extend15,
                w2_ProductExtend.extend16,
                w2_ProductExtend.extend17,
                w2_ProductExtend.extend18,
                w2_ProductExtend.extend19,
                w2_ProductExtend.extend20,
                w2_ProductExtend.extend21,
                w2_ProductExtend.extend22,
                w2_ProductExtend.extend23,
                w2_ProductExtend.extend24,
                w2_ProductExtend.extend25,
                w2_ProductExtend.extend26,
                w2_ProductExtend.extend27,
                w2_ProductExtend.extend28,
                w2_ProductExtend.extend29,
                w2_ProductExtend.extend30,
                w2_ProductExtend.extend31,
                w2_ProductExtend.extend32,
                w2_ProductExtend.extend33,
                w2_ProductExtend.extend34,
                w2_ProductExtend.extend35,
                w2_ProductExtend.extend36,
                w2_ProductExtend.extend37,
                w2_ProductExtend.extend38,
                w2_ProductExtend.extend39,
                w2_ProductExtend.extend40,
                w2_ProductExtend.extend41,
                w2_ProductExtend.extend42,
                w2_ProductExtend.extend43,
                w2_ProductExtend.extend44,
                w2_ProductExtend.extend45,
                w2_ProductExtend.extend46,
                w2_ProductExtend.extend47,
                w2_ProductExtend.extend48,
                w2_ProductExtend.extend49,
                w2_ProductExtend.extend50,
                w2_ProductExtend.extend51,
                w2_ProductExtend.extend52,
                w2_ProductExtend.extend53,
                w2_ProductExtend.extend54,
                w2_ProductExtend.extend55,
                w2_ProductExtend.extend56,
                w2_ProductExtend.extend57,
                w2_ProductExtend.extend58,
                w2_ProductExtend.extend59,
                w2_ProductExtend.extend60,
                w2_ProductExtend.extend61,
                w2_ProductExtend.extend62,
                w2_ProductExtend.extend63,
                w2_ProductExtend.extend64,
                w2_ProductExtend.extend65,
                w2_ProductExtend.extend66,
                w2_ProductExtend.extend67,
                w2_ProductExtend.extend68,
                w2_ProductExtend.extend69,
                w2_ProductExtend.extend70,
                w2_ProductExtend.extend71,
                w2_ProductExtend.extend72,
                w2_ProductExtend.extend73,
                w2_ProductExtend.extend74,
                w2_ProductExtend.extend75,
                w2_ProductExtend.extend76,
                w2_ProductExtend.extend77,
                w2_ProductExtend.extend78,
                w2_ProductExtend.extend79,
                w2_ProductExtend.extend80,
                w2_ProductExtend.extend81,
                w2_ProductExtend.extend82,
                w2_ProductExtend.extend83,
                w2_ProductExtend.extend84,
                w2_ProductExtend.extend85,
                w2_ProductExtend.extend86,
                w2_ProductExtend.extend87,
                w2_ProductExtend.extend88,
                w2_ProductExtend.extend89,
                w2_ProductExtend.extend90,
                w2_ProductExtend.extend91,
                w2_ProductExtend.extend92,
                w2_ProductExtend.extend93,
                w2_ProductExtend.extend94,
                w2_ProductExtend.extend95,
                w2_ProductExtend.extend96,
                w2_ProductExtend.extend97,
                w2_ProductExtend.extend98,
                w2_ProductExtend.extend99,
                w2_ProductExtend.extend100,
                w2_ProductExtend.extend101,
                w2_ProductExtend.extend102,
                w2_ProductExtend.extend103,
                w2_ProductExtend.extend104,
                w2_ProductExtend.extend105,
                w2_ProductExtend.extend106,
                w2_ProductExtend.extend107,
                w2_ProductExtend.extend108,
                w2_ProductExtend.extend109,
                w2_ProductExtend.extend110,
                w2_ProductExtend.extend111,
                w2_ProductExtend.extend112,
                w2_ProductExtend.extend113,
                w2_ProductExtend.extend114,
                w2_ProductExtend.extend115,
                w2_ProductExtend.extend116,
                w2_ProductExtend.extend117,
                w2_ProductExtend.extend118,
                w2_ProductExtend.extend119,
                w2_ProductExtend.extend120,
                w2_ProductExtend.extend121,
                w2_ProductExtend.extend122,
                w2_ProductExtend.extend123,
                w2_ProductExtend.extend124,
                w2_ProductExtend.extend125,
                w2_ProductExtend.extend126,
                w2_ProductExtend.extend127,
                w2_ProductExtend.extend128,
                w2_ProductExtend.extend129,
                w2_ProductExtend.extend130,
                w2_ProductExtend.extend131,
                w2_ProductExtend.extend132,
                w2_ProductExtend.extend133,
                w2_ProductExtend.extend134,
                w2_ProductExtend.extend135,
                w2_ProductExtend.extend136,
                w2_ProductExtend.extend137,
                w2_ProductExtend.extend138,
                w2_ProductExtend.extend139,
                w2_ProductExtend.extend140,
		            w2_ProductCategory1.name category_name1,
		            w2_ProductCategory2.name category_name2,
		            w2_ProductCategory3.name category_name3,
		            w2_ProductCategory4.name category_name4,
                w2_ProductCategory5.name category_name5,
                w2_ProductTag.*
          FROM  w2_Product
                LEFT JOIN w2_ProductExtend ON
                (
                  w2_Product.product_id = w2_ProductExtend.product_id
                  AND
                  w2_Product.shop_id = w2_ProductExtend.shop_id
                )
		            LEFT JOIN w2_ProductCategory w2_ProductCategory1
			            ON w2_Product.category_id1 = w2_ProductCategory1.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory2
			            ON w2_Product.category_id2 = w2_ProductCategory2.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory3
			            ON w2_Product.category_id3 = w2_ProductCategory3.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory4
			            ON w2_Product.category_id4 = w2_ProductCategory4.category_id
		            LEFT JOIN w2_ProductCategory w2_ProductCategory5
			            ON w2_Product.category_id5 = w2_ProductCategory5.category_id
                LEFT JOIN w2_ProductTag ON
                (
                  w2_Product.product_id = w2_ProductTag.product_id
                )
         WHERE  w2_Product.shop_id = @shop_id
           AND  (@@ extractionPattern @@)
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetProduct>

  <!-- 商品更新 -->
  <ProductUpdate>
    <Statement>
      <![CDATA[
          EXEC('
           SELECT  w2_Product.*,
                    w2_ProductExtend.*,
                    w2_ProductCategory1.name category_name1,
                    w2_ProductCategory2.name category_name2,
                    w2_ProductCategory3.name category_name3,
                    w2_ProductCategory4.name category_name4,
                    w2_ProductCategory5.name category_name5,
                    w2_ProductTag.*
              FROM  ##' + @shop_id + ' AS tmp
                    INNER JOIN w2_Product ON
                    (
                      tmp.shop_id = w2_Product.shop_id
                      AND
                      tmp.product_id = w2_Product.product_id
                    )
                    LEFT JOIN w2_ProductExtend ON
                    (
                      tmp.shop_id = w2_ProductExtend.shop_id
                      AND
                      tmp.product_id = w2_ProductExtend.product_id
                    )
		                LEFT JOIN w2_ProductCategory w2_ProductCategory1
			                ON w2_Product.category_id1 = w2_ProductCategory1.category_id
		                LEFT JOIN w2_ProductCategory w2_ProductCategory2
			                ON w2_Product.category_id2 = w2_ProductCategory2.category_id
		                LEFT JOIN w2_ProductCategory w2_ProductCategory3
			                ON w2_Product.category_id3 = w2_ProductCategory3.category_id
		                LEFT JOIN w2_ProductCategory w2_ProductCategory4
			                ON w2_Product.category_id4 = w2_ProductCategory4.category_id
		                LEFT JOIN w2_ProductCategory w2_ProductCategory5
			                ON w2_Product.category_id5 = w2_ProductCategory5.category_id
                    LEFT JOIN w2_ProductTag ON
                    (
                      tmp.product_id = w2_ProductTag.product_id
                    )
             WHERE  tmp.product_id = tmp.variation_id
               AND  tmp.mall_id = ''' + @mall_id + '''
          ')
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
    </Parameter>
  </ProductUpdate>

  <!-- 商品＋在庫更新 -->
  <ProductStockUpdate>
    <Statement>
      <![CDATA[
          EXEC('
           SELECT w2_Product.*,
                  w2_ProductStock.*,
                  w2_ProductExtend.*,
                  w2_ProductCategory1.name category_name1,  
                  w2_ProductCategory2.name category_name2,
                  w2_ProductCategory3.name category_name3,
                  w2_ProductCategory4.name category_name4,
                  w2_ProductCategory5.name category_name5,
                  w2_ProductTag.*
             FROM ##' + @shop_id + ' AS tmp
                  INNER JOIN w2_Product ON
                  (
                    tmp.shop_id = w2_Product.shop_id
                    AND
                    tmp.product_id = w2_Product.product_id
                  )
                  LEFT JOIN w2_ProductExtend ON
                  (
                    tmp.shop_id = w2_ProductExtend.shop_id
                    AND
                    tmp.product_id = w2_ProductExtend.product_id
                  )
                  LEFT JOIN w2_ProductStock ON
                  (
                    tmp.shop_id = w2_ProductStock.shop_id
                    AND
                    tmp.product_id = w2_ProductStock.product_id
                    AND
                    tmp.variation_id = w2_ProductStock.variation_id
                  )
	                LEFT JOIN w2_ProductCategory w2_ProductCategory1
		                ON w2_Product.category_id1 = w2_ProductCategory1.category_id
	                LEFT JOIN w2_ProductCategory w2_ProductCategory2
		                ON w2_Product.category_id2 = w2_ProductCategory2.category_id
	                LEFT JOIN w2_ProductCategory w2_ProductCategory3
		                ON w2_Product.category_id3 = w2_ProductCategory3.category_id
	                LEFT JOIN w2_ProductCategory w2_ProductCategory4
		                ON w2_Product.category_id4 = w2_ProductCategory4.category_id
	                LEFT JOIN w2_ProductCategory w2_ProductCategory5
		                ON w2_Product.category_id5 = w2_ProductCategory5.category_id
                  LEFT JOIN w2_ProductTag ON
                  (
                    tmp.product_id = w2_ProductTag.product_id
                  )
            WHERE  tmp.product_id = tmp.variation_id
              AND  tmp.mall_id = ''' + @mall_id + '''
          ')
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
    </Parameter>
  </ProductStockUpdate>

  <!-- 商品バリエーション＋在庫更新 -->
  <ProductViewStockUpdate>
    <Statement>
      <![CDATA[
        EXEC('
          SELECT  w2_ProductView.*,
                  w2_ProductExtend.*,
                  w2_ProductTag.*
            FROM  ##' + @shop_id + ' AS tmp
                  INNER JOIN w2_ProductView ON
                  (
                    tmp.shop_id = w2_ProductView.shop_id
                    AND
                    tmp.product_id = w2_ProductView.product_id
                    AND
                    tmp.variation_id = w2_ProductView.variation_id
                  )
                  LEFT JOIN w2_ProductExtend ON
                  (
                    tmp.shop_id = w2_ProductExtend.shop_id
                    AND
                    tmp.product_id = w2_ProductExtend.product_id
                  )
                  LEFT JOIN w2_ProductTag ON
                  (
                    tmp.product_id = w2_ProductTag.product_id
                  )
           WHERE tmp.mall_id = ''' + @mall_id + '''
          ORDER BY w2_ProductView.display_order
        ')
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
    </Parameter>
  </ProductViewStockUpdate>


  <!-- 商品バリエーション＋在庫更新(楽天モール連携SKU移行状態) -->
  <ProductViewStockUpdateSku>
    <Statement>
      <![CDATA[
        EXEC('
          SELECT  w2_ProductView.*,
                  w2_ProductExtend.*,
                  w2_ProductTag.*
            FROM  ##' + @shop_id + ' AS tmp
                  INNER JOIN w2_ProductView ON
                  (
                    tmp.shop_id = w2_ProductView.shop_id
                    AND
                    tmp.product_id = w2_ProductView.product_id
                    AND
                    tmp.variation_id = w2_ProductView.variation_id
                  )
                  LEFT JOIN w2_ProductExtend ON
                  (
                    tmp.shop_id = w2_ProductExtend.shop_id
                    AND
                    tmp.product_id = w2_ProductExtend.product_id
                  )
                  LEFT JOIN w2_ProductTag ON
                  (
                    tmp.product_id = w2_ProductTag.product_id
                  )
           WHERE tmp.mall_id = ''' + @mall_id + '''
          ORDER BY w2_ProductView.product_id
        ')
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
    </Parameter>
  </ProductViewStockUpdateSku>

  <!-- 商品ビュー取得(商品アップロード時) -->
  <GetProductViewYahooValiation>
    <Statement>
      <![CDATA[
        SELECT  w2_ProductView.product_id,
                w2_ProductView.stock_management_kbn,
				        w2_ProductView.variation_id,
                w2_ProductView.mall_variation_id1,
                w2_ProductView.mall_variation_id2,
                w2_ProductView.mall_variation_type,
                w2_ProductView.variation_name1,
                w2_ProductView.variation_name2,
				        w2_ProductExtend.extend49,
                w2_ProductExtend.extend50,
                w2_ProductTag.*
          FROM  w2_ProductView
                INNER JOIN w2_Product ON    -- 抽出条件用に加える
                (
                  w2_Product.shop_id = w2_ProductView.shop_id
                  AND
                  w2_Product.product_id = w2_ProductView.product_id
                )
                LEFT JOIN w2_ProductExtend ON    -- 抽出条件用に加える
                (
                  w2_ProductExtend.shop_id = w2_Product.shop_id
                  AND
                  w2_ProductExtend.product_id = w2_Product.product_id
                )
                LEFT JOIN w2_ProductTag ON
                (
                  w2_Product.product_id = w2_ProductTag.product_id
                )
         WHERE  w2_ProductView.shop_id = @shop_id
           AND  (@@ extractionPattern @@)
        ORDER BY  w2_ProductView.display_order
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetProductViewYahooValiation>

  <!-- 商品ビュー取得(商品アップロード時) -->
  <GetProductViewYahooValiationTmpUse>
    <Statement>
      <![CDATA[
       EXEC('
        SELECT  w2_ProductView.product_id,
				        w2_ProductView.stock_management_kbn,
				        w2_ProductView.variation_id,
				        w2_ProductView.mall_variation_id1,
				        w2_ProductView.mall_variation_id2,
				        w2_ProductView.mall_variation_type,
				        w2_ProductView.variation_name1,
				        w2_ProductView.variation_name2,
                w2_ProductView.display_order,
				        w2_ProductExtend.extend49,
                w2_ProductExtend.extend50,
                w2_ProductTag.*
          FROM  ##' + @shop_id + ' AS tmp
                INNER JOIN w2_ProductView ON
                (
                  tmp.shop_id = w2_ProductView.shop_id
                  AND
                  tmp.product_id = w2_ProductView.product_id
                )
                LEFT JOIN w2_ProductExtend ON
                (
                  tmp.shop_id = w2_ProductExtend.shop_id
                  AND
                  tmp.product_id = w2_ProductExtend.product_id
                )
                LEFT JOIN w2_ProductTag ON
                (
                  tmp.product_id = w2_ProductTag.product_id
                )
         WHERE  tmp.mall_id = ''' + @mall_id + '''
        ORDER BY  w2_ProductView.display_order
       ')
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetProductViewYahooValiationTmpUse>

  <!-- 楽天カテゴリ取得(商品アップロード時) -->
  <GetRakutenCategory>
    <Statement>
      <![CDATA[
       EXEC('
        SELECT  w2_Product.*,
                w2_ProductExtend.*,
                w2_ProductTag.*
          FROM  ##' + @shop_id + ' AS tmp
                INNER JOIN  w2_Product ON
                (
                  tmp.shop_id = w2_Product.shop_id
                  AND
                  tmp.product_id = w2_Product.product_id
                )
                LEFT JOIN w2_ProductExtend ON
                (
                  tmp.shop_id = w2_ProductExtend.shop_id
                  AND
                  tmp.product_id = w2_ProductExtend.product_id
                )
                LEFT JOIN w2_ProductTag ON
                (
                  tmp.product_id = w2_ProductTag.product_id
                )
         WHERE  tmp.mall_id = ''' + @mall_id + '''
       ')
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
    </Parameter>
   </GetRakutenCategory>
 </Product>
