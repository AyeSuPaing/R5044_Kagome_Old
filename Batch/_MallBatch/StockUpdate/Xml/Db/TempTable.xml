<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : テンポラリテーブル系SQLステートメントXML(TempTable.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright w2solution Co.,Ltd. 2009 All Rights Reserved.
=========================================================================================================
-->
<TempTable>

  <!-- ホストID取得 -->
  <GetHostId>
    <Statement>
      <![CDATA[
        SELECT host_id()
			]]>
    </Statement>
    <Parameter>
    </Parameter>
  </GetHostId>

  <!-- 対象ログ取得 -->
  <GetTargetLog>
    <Statement>
      <![CDATA[
        SELECT  TOP 1 
                w2_MallCooperationUpdateLog.*,
	              w2_Product.use_variation_flg
          FROM  w2_MallCooperationUpdateLog 
                INNER JOIN w2_Product ON 
                (
                  w2_MallCooperationUpdateLog.shop_id = w2_Product.shop_id
	                AND 
                  w2_MallCooperationUpdateLog.product_id = w2_Product.product_id
                )
                INNER JOIN w2_MallCooperationSetting ON
                (
                  w2_MallCooperationSetting.shop_id = w2_MallCooperationUpdateLog.shop_id
                  AND 
                  w2_MallCooperationSetting.mall_id = w2_MallCooperationUpdateLog.mall_id
                  AND
                  w2_MallCooperationSetting.valid_flg = '1'
                  AND
                  w2_MallCooperationSetting.del_flg = '0'
                )
                INNER JOIN w2_MallExhibitsConfig ON
                (
                  w2_MallExhibitsConfig.shop_id = w2_MallCooperationUpdateLog.shop_id
                  AND
                  w2_MallExhibitsConfig.product_id = w2_MallCooperationUpdateLog.product_id
                )
         WHERE  action_status = '00'
                AND  w2_MallCooperationSetting.mall_kbn IN ('R', 'Y')
                AND  (
                  w2_MallCooperationSetting.mall_exhibits_config = ''
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH1'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg1 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH2'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg2 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH3'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg3 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH4'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg4 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH5'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg5 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH6'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg6 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH7'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg7 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH8'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg8 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH9'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg9 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH10'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg10 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH11'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg11 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH12'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg12 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH13'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg13 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH14'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg14 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH15'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg15 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH16'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg16 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH17'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg17 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH18'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg18 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH19'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg19 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH20'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg20 = '1'
                  )
                )
        ORDER BY 
                w2_MallCooperationUpdateLog.date_created,
		    	      w2_MallCooperationUpdateLog.master_kbn,
                w2_MallCooperationUpdateLog.action_kbn
			]]>
    </Statement>
  </GetTargetLog>

  <!-- テンポラリテーブル作成 -->
  <CreateTmpTable>
    <Statement>
      <![CDATA[
        -- ログテーブル
        CREATE TABLE ##@@ logtablename @@ 
        (
	        [log_no] [bigint] NOT NULL,
	        [shop_id] [nvarchar] (10) NOT NULL DEFAULT (N''),
	        [mall_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [product_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [variation_id] [nvarchar] (60) NOT NULL DEFAULT (N''),
	        [master_kbn] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [action_kbn] [nvarchar] (2) NOT NULL DEFAULT (N''),
	        [action_status] [nvarchar] (2) NOT NULL DEFAULT (N'00'),
	        [date_created] [datetime] NOT NULL DEFAULT (getdate()),
	        [date_changed] [datetime] NOT NULL DEFAULT (getdate())
        ) ON [PRIMARY]
        
        -- 楽天用（バリエーションなし）
        CREATE TABLE ##@@ convtablenamerakuten @@ 
        (
	        [log_no] [bigint] NOT NULL,
	        [shop_id] [nvarchar] (10) NOT NULL DEFAULT (N''),
	        [mall_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [product_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
          [variation_id] [nvarchar] (60) NOT NULL DEFAULT (N''),
	        [master_kbn] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [action_kbn] [nvarchar] (2) NOT NULL DEFAULT (N''),
	        [action_status] [nvarchar] (2) NOT NULL DEFAULT (N'00'),
	        [date_created] [datetime] NOT NULL DEFAULT (getdate()),
	        [date_changed] [datetime] NOT NULL DEFAULT (getdate())
        ) ON [PRIMARY]

        -- Yahoo用（バリエーションなし）
        CREATE TABLE ##@@ convtablenameyahoo @@ 
        (
	        [log_no] [bigint] NOT NULL,
	        [shop_id] [nvarchar] (10) NOT NULL DEFAULT (N''),
	        [mall_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [product_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
          [variation_id] [nvarchar] (60) NOT NULL DEFAULT (N''),
	        [master_kbn] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [action_kbn] [nvarchar] (2) NOT NULL DEFAULT (N''),
	        [action_status] [nvarchar] (2) NOT NULL DEFAULT (N'00'),
	        [date_created] [datetime] NOT NULL DEFAULT (getdate()),
	        [date_changed] [datetime] NOT NULL DEFAULT (getdate())
        ) ON [PRIMARY]
        
        -- 楽天用（バリエーションあり）
        CREATE TABLE ##@@ convvtablenamerakuten @@ 
        (
	        [shop_id] [nvarchar] (10) NOT NULL DEFAULT (N''),
	        [mall_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [product_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [variation_id] [nvarchar] (60) NOT NULL DEFAULT (N''),
	        [master_kbn] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [action_kbn] [nvarchar] (2) NOT NULL DEFAULT (N''),
	        [action_status] [nvarchar] (2) NOT NULL DEFAULT (N'00')
        ) ON [PRIMARY]

        -- Yahoo用（バリエーションあり）
        CREATE TABLE ##@@ convvtablenameyahoo @@ 
        (
	        [shop_id] [nvarchar] (10) NOT NULL DEFAULT (N''),
	        [mall_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [product_id] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [variation_id] [nvarchar] (60) NOT NULL DEFAULT (N''),
	        [master_kbn] [nvarchar] (30) NOT NULL DEFAULT (N''),
	        [action_kbn] [nvarchar] (2) NOT NULL DEFAULT (N''),
	        [action_status] [nvarchar] (2) NOT NULL DEFAULT (N'00')
        ) ON [PRIMARY]
     ]]>
    </Statement>
    <Parameter>
    </Parameter>
  </CreateTmpTable>

  <!-- テンポラリテーブル設定情報取得 -->
  <GetTmpDetail>
    <Statement>
      <![CDATA[
        SELECT  DISTINCT
				        w2_MallCooperationUpdateLog.master_kbn,
                w2_MallCooperationUpdateLog.action_kbn,
                min(w2_MallCooperationUpdateLog.date_created) as lastDate,
                w2_Product.use_variation_flg
          FROM  w2_MallCooperationUpdateLog
                INNER JOIN w2_Product ON
                (
                  w2_MallCooperationUpdateLog.shop_id = w2_Product.shop_id
                  AND
                  w2_MallCooperationUpdateLog.product_id = w2_Product.product_id
                )
         WHERE  w2_MallCooperationUpdateLog.shop_id = @shop_id
           AND  w2_MallCooperationUpdateLog.mall_id = @mall_id
           AND  w2_MallCooperationUpdateLog.action_status = '00'
        GROUP BY
                w2_MallCooperationUpdateLog.master_kbn,
                w2_MallCooperationUpdateLog.action_kbn,
                w2_Product.use_variation_flg
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetTmpDetail>

  <!-- テンポラリテーブル登録 -->
  <InsertToTmpLogTable>
    <Statement>
      <![CDATA[
        -- ログ更新用テンポラリテーブル登録
        INSERT  ##@@ logtablename @@
        SELECT  w2_MallCooperationUpdateLog.log_no,
                w2_MallCooperationUpdateLog.shop_id,
                w2_MallCooperationUpdateLog.mall_id,
                w2_MallCooperationUpdateLog.product_id,
                w2_MallCooperationUpdateLog.variation_id,
                w2_MallCooperationUpdateLog.master_kbn,
                w2_MallCooperationUpdateLog.action_kbn,
                w2_MallCooperationUpdateLog.action_status,
                w2_MallCooperationUpdateLog.date_created,
                w2_MallCooperationUpdateLog.date_changed
          FROM  w2_MallCooperationUpdateLog
                INNER JOIN w2_Product ON
                (
                  w2_MallCooperationUpdateLog.shop_id = w2_Product.shop_id
                  AND
                  w2_MallCooperationUpdateLog.product_id = w2_Product.product_id
                  AND
                  w2_Product.use_variation_flg = @use_variation_flg
                )
                INNER JOIN w2_MallCooperationSetting ON
                (
                  w2_MallCooperationSetting.shop_id = w2_MallCooperationUpdateLog.shop_id
                  AND 
                  w2_MallCooperationSetting.mall_id = w2_MallCooperationUpdateLog.mall_id
                  AND
                  w2_MallCooperationSetting.valid_flg = '1'
                  AND
                  w2_MallCooperationSetting.del_flg = '0'
                )
                INNER JOIN w2_MallExhibitsConfig ON
                (
                  w2_MallExhibitsConfig.shop_id = w2_MallCooperationUpdateLog.shop_id
                  AND
                  w2_MallExhibitsConfig.product_id = w2_MallCooperationUpdateLog.product_id
                )
         WHERE  w2_MallCooperationUpdateLog.action_status = '00'
           AND  w2_MallCooperationUpdateLog.master_kbn = @master_kbn
           AND  w2_MallCooperationUpdateLog.action_kbn = @action_kbn 
           AND  (
                  w2_MallCooperationSetting.mall_exhibits_config = ''
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH1'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg1 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH2'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg2 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH3'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg3 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH4'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg4 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH5'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg5 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH6'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg6 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH7'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg7 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH8'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg8 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH9'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg9 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH10'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg10 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH11'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg11 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH12'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg12 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH13'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg13 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH14'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg14 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH15'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg15 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH16'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg16 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH17'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg17 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH18'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg18 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH19'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg19 = '1'
                  )
                  OR
                  (
                    w2_MallCooperationSetting.mall_exhibits_config = 'EXH20'
                    AND
                    w2_MallExhibitsConfig.exhibits_flg20 = '1'
                  )
                )
        ORDER BY w2_MallCooperationUpdateLog.date_created DESC

        -- 重複排除
        DELETE  ##@@ logtablename @@
         WHERE  EXISTS (
                        SELECT  log_no
	                        FROM  ##@@ logtablename @@ b
	                       WHERE	##@@ logtablename @@.shop_id = b.shop_id
	                         AND	##@@ logtablename @@.product_id = b.product_id
	                         AND	##@@ logtablename @@.variation_id = b.variation_id
                           AND  ##@@ logtablename @@.mall_id = b.mall_id
	                         AND	##@@ logtablename @@.log_no > b.log_no	  -- I → U となったときのために新しい方を削除
	                     )
		  ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="mall_id" Type="nvarchar" Size="30" />
      <Input Name="master_kbn" Type="nvarchar" Size="30" />
      <Input Name="action_kbn" Type="nvarchar" Size="2" />
      <Input Name="use_variation_flg" Type="nvarchar" Size="2" />
    </Parameter>
  </InsertToTmpLogTable>

  <!-- 商品コンバータ用テンポラリテーブル登録（商品マスタ単位） -->
  <InsertToTmpConvTable>
    <Statement>
      <![CDATA[
        -- 商品コンバータ用テンポラリテーブル登録(楽天用)
        INSERT  ##@@ convtablenamerakuten @@
        SELECT  ##@@ logtablename @@.log_no,
                ##@@ logtablename @@.shop_id,
                ##@@ logtablename @@.mall_id,
                ##@@ logtablename @@.product_id,
                ##@@ logtablename @@.variation_id,
                ##@@ logtablename @@.master_kbn,
                ##@@ logtablename @@.action_kbn,
                ##@@ logtablename @@.action_status,
                ##@@ logtablename @@.date_created,
                ##@@ logtablename @@.date_changed
        FROM    w2_Product
	              INNER JOIN ##@@ logtablename @@ ON  
                (
                  ##@@ logtablename @@.shop_id = w2_Product.shop_id
	                AND 
                  ##@@ logtablename @@.product_id = w2_Product.product_id
                )
                INNER JOIN w2_MallCooperationSetting ON
                (
                  w2_MallCooperationSetting.shop_id = ##@@ logtablename @@.shop_id
                  AND 
                  w2_MallCooperationSetting.mall_id = ##@@ logtablename @@.mall_id
                  AND
                  w2_MallCooperationSetting.valid_flg = '1'
                  AND
                  w2_MallCooperationSetting.mall_kbn = 'R'
                  AND
                  w2_MallCooperationSetting.del_flg = '0'
                )
                INNER JOIN w2_MallExhibitsConfig ON
                (
                  w2_MallExhibitsConfig.shop_id = ##@@ logtablename @@.shop_id
                  AND
                  w2_MallExhibitsConfig.product_id = ##@@ logtablename @@.product_id
                )
        WHERE   w2_MallCooperationSetting.mall_exhibits_config = ''
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH1'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg1 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH2'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg2 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH3'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg3 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH4'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg4 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH5'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg5 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH6'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg6 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH7'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg7 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH8'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg8 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH9'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg9 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH10'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg10 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH11'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg11 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH12'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg12 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH13'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg13 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH14'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg14 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH15'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg15 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH16'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg16 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH17'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg17 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH18'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg18 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH19'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg19 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH20'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg20 = '1'
                )
                
        -- 商品コンバータ用テンポラリテーブル登録(Yahoo!用)
        INSERT  ##@@ convtablenameyahoo @@
        SELECT  ##@@ logtablename @@.log_no,
                ##@@ logtablename @@.shop_id,
                ##@@ logtablename @@.mall_id,
                ##@@ logtablename @@.product_id,
                ##@@ logtablename @@.variation_id,
                ##@@ logtablename @@.master_kbn,
                ##@@ logtablename @@.action_kbn,
                ##@@ logtablename @@.action_status,
                ##@@ logtablename @@.date_created,
                ##@@ logtablename @@.date_changed
          FROM  w2_Product
	              INNER JOIN ##@@ logtablename @@ ON
                (
                  ##@@ logtablename @@.shop_id = w2_Product.shop_id
	                AND 
                  ##@@ logtablename @@.product_id = w2_Product.product_id
                )
               INNER JOIN w2_MallCooperationSetting ON
                (
                  w2_MallCooperationSetting.shop_id = ##@@ logtablename @@.shop_id
                  AND 
                  w2_MallCooperationSetting.mall_id = ##@@ logtablename @@.mall_id
                  AND
                  w2_MallCooperationSetting.valid_flg = '1'
                  AND
                  w2_MallCooperationSetting.mall_kbn = 'Y'
                  AND
                  w2_MallCooperationSetting.del_flg = '0'
                )
                INNER JOIN w2_MallExhibitsConfig ON
                (
                  w2_MallExhibitsConfig.shop_id = ##@@ logtablename @@.shop_id
                  AND
                  w2_MallExhibitsConfig.product_id = ##@@ logtablename @@.product_id
                )
          WHERE   w2_MallCooperationSetting.mall_exhibits_config = ''
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH1'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg1 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH2'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg2 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH3'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg3 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH4'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg4 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH5'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg5 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH6'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg6 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH7'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg7 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH8'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg8 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH9'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg9 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH10'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg10 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH11'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg11 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH12'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg12 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH13'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg13 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH14'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg14 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH15'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg15 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH16'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg16 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH17'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg17 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH18'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg18 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH19'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg19 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH20'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg20 = '1'
                )
      ]]>
    </Statement>
    <Parameter>
    </Parameter>
  </InsertToTmpConvTable>

  <!-- 商品コンバータ用テンポラリテーブル登録（バリエーション単位） -->
  <InsertToVTmpConvTable>
    <Statement>
      <![CDATA[
        -- 商品コンバータ用テンポラリテーブル登録(楽天用)
        INSERT  ##@@ convvtablenamerakuten @@
        SELECT  DISTINCT
                ##@@ logtablename @@.shop_id,
                ##@@ logtablename @@.mall_id,
                ##@@ logtablename @@.product_id,
                w2_ProductVariationView.variation_id,
                ##@@ logtablename @@.master_kbn,
                ##@@ logtablename @@.action_kbn,
                ##@@ logtablename @@.action_status
          FROM  w2_ProductVariationView 
                INNER JOIN ##@@ logtablename @@ ON  
                (
                  ##@@ logtablename @@.shop_id = w2_ProductVariationView.shop_id
	                AND 
                  ##@@ logtablename @@.product_id = w2_ProductVariationView.product_id
                )
                INNER JOIN w2_MallCooperationSetting ON
                (
                  w2_MallCooperationSetting.shop_id = ##@@ logtablename @@.shop_id
                  AND 
                  w2_MallCooperationSetting.mall_id = ##@@ logtablename @@.mall_id
                  AND
                  w2_MallCooperationSetting.valid_flg = '1'
                  AND
                  w2_MallCooperationSetting.mall_kbn = 'R'
                  AND
                  w2_MallCooperationSetting.del_flg = '0'
                )
                INNER JOIN w2_MallExhibitsConfig ON
                (
                  w2_MallExhibitsConfig.shop_id = ##@@ logtablename @@.shop_id
                  AND
                  w2_MallExhibitsConfig.product_id = ##@@ logtablename @@.product_id
                )
        @@ WHERE @@
             AND w2_MallCooperationSetting.mall_exhibits_config = ''
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH1'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg1 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH2'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg2 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH3'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg3 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH4'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg4 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH5'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg5 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH6'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg6 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH7'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg7 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH8'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg8 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH9'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg9 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH10'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg10 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH11'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg11 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH12'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg12 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH13'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg13 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH14'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg14 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH15'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg15 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH16'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg16 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH17'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg17 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH18'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg18 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH19'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg19 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH20'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg20 = '1'
                )
        
       

        -- 商品コンバータ用テンポラリテーブル登録(Yahoo!用)
        INSERT  ##@@ convvtablenameyahoo @@
        SELECT  DISTINCT
                ##@@ logtablename @@.shop_id,
                ##@@ logtablename @@.mall_id,
                ##@@ logtablename @@.product_id,
                w2_ProductVariationView.variation_id,
                ##@@ logtablename @@.master_kbn,
                ##@@ logtablename @@.action_kbn,
                ##@@ logtablename @@.action_status
          FROM  w2_ProductVariationView
	              INNER JOIN ##@@ logtablename @@ ON  
                (
                  ##@@ logtablename @@.shop_id = w2_ProductVariationView.shop_id
	                AND 
                  ##@@ logtablename @@.product_id = w2_ProductVariationView.product_id
                )
               INNER JOIN w2_MallCooperationSetting ON
                (
                  w2_MallCooperationSetting.shop_id = ##@@ logtablename @@.shop_id
                  AND 
                  w2_MallCooperationSetting.mall_id = ##@@ logtablename @@.mall_id
                  AND
                  w2_MallCooperationSetting.valid_flg = '1'
                  AND
                  w2_MallCooperationSetting.mall_kbn = 'Y'
                  AND
                  w2_MallCooperationSetting.del_flg = '0'
                )
                INNER JOIN w2_MallExhibitsConfig ON
                (
                  w2_MallExhibitsConfig.shop_id = ##@@ logtablename @@.shop_id
                  AND
                  w2_MallExhibitsConfig.product_id = ##@@ logtablename @@.product_id
                )
        @@ WHERE @@
             AND w2_MallCooperationSetting.mall_exhibits_config = ''
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH1'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg1 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH2'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg2 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH3'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg3 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH4'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg4 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH5'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg5 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH6'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg6 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH7'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg7 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH8'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg8 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH9'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg9 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH10'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg10 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH11'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg11 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH12'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg12 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH13'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg13 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH14'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg14 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH15'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg15 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH16'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg16 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH17'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg17 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH18'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg18 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH19'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg19 = '1'
                )
                OR
                (
                  w2_MallCooperationSetting.mall_exhibits_config = 'EXH20'
                  AND
                  w2_MallExhibitsConfig.exhibits_flg20 = '1'
                )
      ]]>
    </Statement>
    <Parameter>
    </Parameter>
  </InsertToVTmpConvTable>

  <!-- テンポラリテーブル区分取得 -->
  <SelectToTmpTable>
    <Statement>
      <![CDATA[
        SELECT DISTINCT
                w2_MallCooperationUpdateLog.master_kbn,
                w2_MallCooperationUpdateLog.action_kbn
          FROM  ##@@ tablename @@
      ]]>
    </Statement>
    <Parameter>
    </Parameter>
  </SelectToTmpTable>
  
</TempTable>