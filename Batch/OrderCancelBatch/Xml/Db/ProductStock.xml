<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : 商品在庫系SQLステートメントXML(ProductStock.xml)  ※管理画面より引用
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright w2solution Co.,Ltd. 2012 All Rights Reserved.
=========================================================================================================
-->
<ProductStock>

  <!-- 商品在庫情報の論理在庫、実在庫数、引当済実在庫数更新 -->
  <AddProductStock>
    <Statement>
      <![CDATA[
        UPDATE 
            w2_ProductStock 
        SET 
            w2_ProductStock.stock = w2_ProductStock.stock + @stock,
            w2_ProductStock.realstock = w2_ProductStock.realstock + @realstock,
            w2_ProductStock.realstock_b = w2_ProductStock.realstock_b + @realstock_b,
            w2_ProductStock.realstock_c = w2_ProductStock.realstock_c + @realstock_c,
            w2_ProductStock.realstock_reserved = w2_ProductStock.realstock_reserved + @realstock_reserved,
            w2_ProductStock.date_changed = getdate(),
            w2_ProductStock.last_changed = @last_changed
        WHERE 
            w2_ProductStock.shop_id = @shop_id 
          AND
            w2_ProductStock.product_id = @product_id 
          AND
            w2_ProductStock.variation_id = @variation_id 
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="product_id" Type="nvarchar" Size="30" />
      <Input Name="variation_id" Type="nvarchar" Size="60" />
      <Input Name="stock" Type="int" />
      <Input Name="realstock" Type="int" />
      <Input Name="realstock_b" Type="int" />
      <Input Name="realstock_c" Type="int" />
      <Input Name="realstock_reserved" Type="int" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </AddProductStock>

  <!-- 商品在庫履歴情報追加 -->
  <InsertProductStockHistory>
    <Statement>
      <![CDATA[
        INSERT
         w2_ProductStockHistory (
              order_id,
              shop_id,
              product_id,
              variation_id,
              action_status,
              add_stock,
              add_realstock,
              add_realstock_b,
              add_realstock_c,
              add_realstock_reserved,
              update_memo,
              date_created,
              last_changed
          )
          VALUES
          (
              @order_id,
              @shop_id,
              @product_id,
              @variation_id,
              @action_status,
              @add_stock,
              @add_realstock,
              @add_realstock_b,
              @add_realstock_c,
              @add_realstock_reserved,
              @update_memo,
              getdate(),
              @last_changed
          )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="product_id" Type="nvarchar" Size="30" />
      <Input Name="variation_id" Type="nvarchar" Size="60" />
      <Input Name="action_status" Type="nvarchar" Size="10" />
      <Input Name="add_stock" Type="int" />
      <Input Name="add_realstock" Type="int" />
      <Input Name="add_realstock_b" Type="int" />
      <Input Name="add_realstock_c" Type="int" />
      <Input Name="add_realstock_reserved" Type="int" />
      <Input Name="update_memo" Type="nvarchar" Size="200" />
      <Input Name="date_created" Type="datetime" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </InsertProductStockHistory>
  
</ProductStock>