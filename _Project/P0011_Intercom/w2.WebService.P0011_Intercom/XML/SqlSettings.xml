<?xml version="1.0" encoding="utf-8" ?>
<root>
  <section id="InsertUserData">
    <sql>
      <!-- SQL文を定義 -->
      <state>
        <![CDATA[
        INSERT INTO W2_USER
        (
          user_id,
          user_kbn,
          mall_id,
          name,
          name1,
          name2,
          name_kana,
          name_kana1,
          name_kana2,
          mail_addr,
          zip,
          zip1,
          zip2,
          addr,
          addr1,
          addr2,
          addr3,
          addr4,
          tel1,
          tel1_1,
          tel1_2,
          tel1_3,
          sex,
          birth,
          birth_year,
          birth_month,
          birth_day,
          company_name,
          company_post_name,
          attribute1,
          login_id,
          password,
          career_id,
          mail_flg,
          del_flg,
          last_changed,
          member_rank_id
         )
         VALUES
         (
          @user_id,
          'PC_USER',
          'OWN_SITE',
          @name1 + @name2,
          @name1,
          @name2,
          @name_kana1 + @name_kana2,
          @name_kana1,
          @name_kana2,
          @mail_addr,
          @zip1 + '-' + @zip2,
          @zip1,
          @zip2,
          @addr1 + @addr2 + @addr3 + @addr4,
          @addr1,
          @addr2,
          @addr3,
          @addr4,
          @tel1_1 + '-' + @tel1_2 + '-' + @tel1_3,
          @tel1_1,
          @tel1_2,
          @tel1_3,
          @sex,
          CASE
            WHEN ISNULL(@birth_year,'') = '' THEN '1900/01/01'
            WHEN ISNULL(@birth_month,'') = '' THEN '1900/01/01'
            WHEN ISNULL(@birth_day,'') = '' THEN '1900/01/01'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN CONVERT(DATETIME,@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                ELSE '1900/01/01'
              END
          END,
          CASE
            WHEN ISNULL(@birth_year,'') = '' THEN '1900'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN @birth_year
                ELSE '1900'
              END
          END,
          CASE
            WHEN ISNULL(@birth_month,'') = '' THEN '1'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN @birth_month
                ELSE '1'
              END
          END,
          CASE
            WHEN ISNULL(@birth_day,'') = '' THEN '1'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN @birth_day
                ELSE '1'
              END
          END,
          @company_name,
          @company_post_name,
          @attribute1,
          @login_id,
          @password,
          '00pc',
          @mail_flg,
          @del_flg,
          @last_changed,
          'member'
         )
        ]]>
      </state>
      <!-- SQLパラメタを定義 pluginargnameはプラグインの引数のハッシュKEY pluginargtypeはハッシュから取出す時の型 -->
      <params>
        <param name="@user_id" dtcolname="user_id"/>
        <param name="@name1" dtcolname="name1"/>
        <param name="@name2" dtcolname="name2"/>
        <param name="@name_kana1" dtcolname="name_kana1"/>
        <param name="@name_kana2" dtcolname="name_kana2"/>
        <param name="@mail_addr" dtcolname="mail_addr"/>
        <param name="@zip1" dtcolname="zip1"/>
        <param name="@zip2" dtcolname="zip2"/>
        <param name="@addr1" dtcolname="addr1"/>
        <param name="@addr2" dtcolname="addr2"/>
        <param name="@addr3" dtcolname="addr3"/>
        <param name="@addr4" dtcolname="addr4"/>
        <param name="@tel1_1" dtcolname="tel1_1"/>
        <param name="@tel1_2" dtcolname="tel1_2"/>
        <param name="@tel1_3" dtcolname="tel1_3"/>
        <param name="@sex" dtcolname="sex"/>
        <param name="@birth_year" dtcolname="birth_year"/>
        <param name="@birth_month" dtcolname="birth_month"/>
        <param name="@birth_day" dtcolname="birth_day"/>
        <param name="@company_name" dtcolname="company_name"/>
        <param name="@company_post_name" dtcolname="company_post_name"/>
        <param name="@attribute1" dtcolname="attribute1"/>
        <param name="@login_id" dtcolname="login_id"/>
        <param name="@password" dtcolname="password"/>
        <param name="@mail_flg" dtcolname="mail_flg"/>
        <param name="@del_flg" dtcolname="del_flg"/>
        <param name="@last_changed" dtcolname="last_changed"/>
      </params>
    </sql>
  </section>
  <section id="UpdateUserData">
    <sql>
      <!-- SQL文を定義 -->
      <state>
        <![CDATA[
        UPDATE W2_USER
          SET 
          name = @name1 + @name2,
          name1 = @name1,
          name2 = @name2,
          name_kana = @name_kana1 + @name_kana2,
          name_kana1 = @name_kana1,
          name_kana2 = @name_kana2,
          mail_addr = @mail_addr,
          zip = @zip1 + '-' + @zip2,
          zip1 = @zip1,
          zip2 = @zip2,
          addr = @addr1 + @addr2 + @addr3 + @addr4,
          addr1 = @addr1,
          addr2 = @addr2,
          addr3 = @addr3,
          addr4 = @addr4,
          tel1 = @tel1_1 + '-' + @tel1_2 + '-' + @tel1_3,
          tel1_1 = @tel1_1,
          tel1_2 = @tel1_2,
          tel1_3 = @tel1_3,
          sex = @sex,
          birth = 
          CASE
            WHEN ISNULL(@birth_year,'') = '' THEN '1900/01/01'
            WHEN ISNULL(@birth_month,'') = '' THEN '1900/01/01'
            WHEN ISNULL(@birth_day,'') = '' THEN '1900/01/01'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN CONVERT(DATETIME,@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                ELSE '1900/01/01'
              END
          END,
          birth_year = 
           CASE
            WHEN ISNULL(@birth_year,'') = '' THEN '1900'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN @birth_year
                ELSE '1900'
              END
          END,
          birth_month = 
          CASE
            WHEN ISNULL(@birth_month,'') = '' THEN '1'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN @birth_month
                ELSE '1'
              END
          END,
          birth_day = 
          CASE
            WHEN ISNULL(@birth_day,'') = '' THEN '1'
            ELSE
              CASE ISDATE(@birth_year + '/' + RIGHT('00' + @birth_month,2) + '/' + RIGHT('00' + @birth_day,2))
                WHEN 1 THEN @birth_day
                ELSE '1'
              END
          END,
          company_name = @company_name,
          company_post_name = @company_post_name,
          login_id = @login_id,
          password = @password,
          mail_flg = @mail_flg,
          del_flg = @del_flg,
          last_changed = @last_changed,
          date_changed = getdate()
        WHERE user_id = @user_id
        AND attribute1 = @attribute1
        ]]>
      </state>
      <!-- SQLパラメタを定義 pluginargnameはプラグインの引数のハッシュKEY pluginargtypeはハッシュから取出す時の型 -->
      <params>
        <param name="@user_id" dtcolname="user_id"/>
        <param name="@name1" dtcolname="name1"/>
        <param name="@name2" dtcolname="name2"/>
        <param name="@name_kana1" dtcolname="name_kana1"/>
        <param name="@name_kana2" dtcolname="name_kana2"/>
        <param name="@mail_addr" dtcolname="mail_addr"/>
        <param name="@zip1" dtcolname="zip1"/>
        <param name="@zip2" dtcolname="zip2"/>
        <param name="@addr1" dtcolname="addr1"/>
        <param name="@addr2" dtcolname="addr2"/>
        <param name="@addr3" dtcolname="addr3"/>
        <param name="@addr4" dtcolname="addr4"/>
        <param name="@tel1_1" dtcolname="tel1_1"/>
        <param name="@tel1_2" dtcolname="tel1_2"/>
        <param name="@tel1_3" dtcolname="tel1_3"/>
        <param name="@sex" dtcolname="sex"/>
        <param name="@birth_year" dtcolname="birth_year"/>
        <param name="@birth_month" dtcolname="birth_month"/>
        <param name="@birth_day" dtcolname="birth_day"/>
        <param name="@company_name" dtcolname="company_name"/>
        <param name="@company_post_name" dtcolname="company_post_name"/>
        <param name="@attribute1" dtcolname="attribute1"/>
        <param name="@login_id" dtcolname="login_id"/>
        <param name="@password" dtcolname="password"/>
        <param name="@mail_flg" dtcolname="mail_flg"/>
        <param name="@del_flg" dtcolname="del_flg"/>
        <param name="@last_changed" dtcolname="last_changed"/>
      </params>
    </sql>
  </section>
  <section id="DeleteUserData">
    <sql>
      <!-- SQL文を定義 -->
      <state>
        <![CDATA[
        UPDATE W2_USER
          SET 
          name = '********',
          name1 = '****',
          name2 = '****',
          name_kana = '********',
          name_kana1 = '****',
          name_kana2 = '****',
          nick_name = '********',
          mail_addr = '********',
          mail_addr2 = '********',
          addr = addr1 + '****',
          addr2 = '****',
          addr3 = '****',
          addr4 = '****',
          tel1 = '********',
          tel1_1 = '****',
          tel1_2 = '****',
          tel1_3 = '****',
          company_name = '****',
          company_post_name = '****',
          login_id = '****',
          mobile_uid = '****',
          del_flg = '1',
          last_changed = @last_changed,
          date_changed = getdate()
        WHERE user_id = @user_id
        AND attribute1 = @attribute1
        ]]>
      </state>
      <!-- SQLパラメタを定義 pluginargnameはプラグインの引数のハッシュKEY pluginargtypeはハッシュから取出す時の型 -->
      <params>
        <param name="@user_id" dtcolname="user_id"/>
        <param name="@attribute1" dtcolname="attribute1"/>
        <param name="@last_changed" dtcolname="last_changed"/>
      </params>
    </sql>
  </section>
  <section id="UpdateOnetimePass">
    <sql>
      <!-- SQL文を定義 -->
      <state>
        <![CDATA[
        UPDATE W2_USER
          SET 
          attribute2 = @onetimepass,
          attribute3 = dateadd(mi,2,getdate()),
          attribute4 = '1'
        WHERE user_id = @w2user_id
        AND attribute1 = @icuser_id
        ]]>
      </state>
      <!-- SQLパラメタを定義 pluginargnameはプラグインの引数のハッシュKEY pluginargtypeはハッシュから取出す時の型 -->
      <params>
        <param name="@w2user_id" dtcolname="w2user_id"/>
        <param name="@icuser_id" dtcolname="icuser_id"/>
        <param name="@onetimepass" dtcolname="onetimepass"/>
      </params>
    </sql>
  </section>
</root>