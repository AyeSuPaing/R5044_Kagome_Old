<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : 注文系SQLステートメントXML(Order.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright W2 Co.,Ltd. 2009 All Rights Reserved.
=========================================================================================================
-->
<Order>
  
  <!-- 注文情報追加処理 -->
  <OrderRegist>
    <Statement>
      <![CDATA[
      INSERT  w2_Order
          (
            w2_Order.order_id,
            w2_Order.user_id,
            w2_Order.shop_id,
            w2_Order.order_kbn,
            w2_Order.order_payment_kbn,
            w2_Order.order_status,
            w2_Order.order_date,
            w2_Order.order_stockreserved_status,
            w2_Order.order_shipped_status,
            w2_Order.order_item_count,
            w2_Order.order_product_count,
            w2_Order.order_price_subtotal,
            w2_Order.order_price_shipping,
            w2_Order.order_price_exchange,
            w2_Order.order_price_total,
            w2_Order.order_discount_set_price,
            w2_Order.order_point_use,
            w2_Order.order_point_use_yen,
            w2_Order.order_point_add,
            w2_Order.order_coupon_use,
            w2_Order.card_kbn,
            w2_Order.card_instruments,
            w2_Order.card_installments_code,
            w2_Order.advcode_first,
            w2_Order.advcode_new,
            w2_Order.career_id,
            w2_Order.remote_addr,
            w2_Order.shipping_id,
            w2_Order.memo,
            w2_Order.date_created,
            w2_Order.date_changed,
            w2_Order.last_changed,
            w2_Order.member_rank_discount_price,
            w2_Order.member_rank_id,
            w2_Order.gift_flg,
            w2_Order.digital_contents_flg,
            w2_Order.shipping_price_separate_estimates_flg,
            w2_Order.order_tax_included_flg,
            w2_Order.order_tax_rate,
            w2_Order.order_tax_round_type,
            w2_Order.setpromotion_product_discount_amount,
            w2_Order.setpromotion_shipping_charge_discount_amount,
            w2_Order.setpromotion_payment_charge_discount_amount,
            w2_Order.payment_order_id,
            w2_Order.fixed_purchase_discount_price,
            w2_Order.fixed_purchase_member_discount_amount,
            w2_Order.last_billed_amount,
            w2_Order.last_order_point_use,
            w2_Order.last_order_point_use_yen,
            w2_Order.combined_org_order_ids,
            w2_Order.management_memo,
            w2_Order.shipping_memo,
            w2_Order.relation_memo,
            w2_Order.regulation_memo,
            w2_Order.order_price_regulation,
            w2_Order.last_auth_flg,
            w2_Order.extend_status39,
            w2_Order.order_price_tax,
            w2_Order.order_price_subtotal_tax,
            w2_Order.settlement_rate,
            w2_Order.settlement_amount,
            w2_Order.settlement_currency,
            w2_Order.shipping_tax_rate,
            w2_Order.payment_tax_rate,
            w2_Order.order_count_order,
            w2_Order.invoice_bundle_flg,
            w2_Order.inflow_contents_id,
            w2_Order.inflow_contents_type,
            w2_Order.receipt_flg,
            w2_Order.receipt_address,
            w2_Order.receipt_proviso,
            w2_Order.external_payment_type,
            w2_Order.attribute1,
            w2_Order.attribute2,
            w2_Order.attribute3,
            w2_Order.attribute4,
            w2_Order.attribute5,
            w2_Order.attribute6,
            w2_Order.attribute7,
            w2_Order.attribute8,
            w2_Order.attribute9,
            w2_Order.attribute10,
            w2_Order.subscription_box_course_id,
            w2_Order.subscription_box_fixed_amount,
            w2_Order.order_subscription_box_order_count,
            w2_Order.storepickup_status
          )
      VALUES  (
            @order_id,
            @user_id,
            @shop_id,
            @order_kbn,
            @order_payment_kbn,
            @order_status,
            @order_date,
            '01',   -- 在庫未引当
            '01',   -- 未出荷
            @order_item_count,
            @order_product_count,
            @order_price_subtotal,
            @order_price_shipping,
            @order_price_exchange,
            @order_price_total, -- 小計 ＋ 配送料 ＋ 決済手数料 - 利用ポイント
            @order_discount_set_price, -- セット値引き金額
            @order_point_use,
            @order_point_use_yen,
            @order_point_add,
            @order_coupon_use,
            @card_kbn,
            @card_instruments,
            @card_installments_code,
            @advcode_first,
            @advcode_new,
            @career_id,
            @remote_addr,
            @shipping_id,
            @memo,
            @date_created,
            @date_changed,
            @last_changed,
            @member_rank_discount_price,
            @member_rank_id,
            @gift_flg,
            @digital_contents_flg,
            @shipping_price_separate_estimates_flg,
            @order_tax_included_flg,
            @order_tax_rate,
            @order_tax_round_type,
            @setpromotion_product_discount_amount,
            @setpromotion_shipping_charge_discount_amount,
            @setpromotion_payment_charge_discount_amount,
            @payment_order_id,
            @fixed_purchase_discount_price,
            @fixed_purchase_member_discount_amount,
            @last_billed_amount,
            @last_order_point_use,
            @last_order_point_use_yen,
            @combined_org_order_ids,
            @management_memo,
            @shipping_memo,
            @relation_memo,
            @regulation_memo,
            @order_price_regulation,
            @last_auth_flg,
            @extend_status39,
            @order_price_tax,
            @order_price_subtotal_tax,
            @settlement_rate,
            @settlement_amount,
            @settlement_currency,
            @shipping_tax_rate,
            @payment_tax_rate,
            @order_count_order,
            @invoice_bundle_flg,
            @inflow_contents_id,
            @inflow_contents_type,
            @receipt_flg,
            @receipt_address,
            @receipt_proviso,
            @external_payment_type,
            @attribute1,
            @attribute2,
            @attribute3,
            @attribute4,
            @attribute5,
            @attribute6,
            @attribute7,
            @attribute8,
            @attribute9,
            @attribute10,
            @subscription_box_course_id,
            @subscription_box_fixed_amount,
            @order_subscription_box_order_count,
            @storepickup_status
          )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="user_id" Type="nvarchar" Size="30" />
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="order_kbn" Type="nvarchar" Size="10" />
      <Input Name="order_payment_kbn" Type="nvarchar" Size="10" />
      <Input Name="order_status" Type="nvarchar" Size="30" />
      <Input Name="order_date" Type="datetime" />
      <Input Name="order_item_count" Type="int" />
      <Input Name="order_product_count" Type="int" />
      <Input Name="order_price_subtotal" Type="decimal" Size="18,3" />
      <Input Name="order_price_shipping" Type="decimal" Size="18,3" />
      <Input Name="order_price_exchange" Type="decimal" Size="18,3" />
      <Input Name="order_price_total" Type="decimal" Size="18,3" />
      <Input Name="order_discount_set_price" Type="decimal" Size="18,3" />
      <Input Name="order_point_use" Type="decimal" />
      <Input Name="order_point_use_yen" Type="decimal" Size="18,3" />
      <Input Name="order_point_add" Type="decimal" />
      <Input Name="order_coupon_use" Type="decimal" Size="18,3" />
      <Input Name="card_kbn" Type="nvarchar" Size="30" />
      <Input Name="card_instruments" Type="nvarchar" Size="30" />
      <Input Name="card_installments_code" Type="nvarchar" Size="10" />
      <Input Name="advcode_first" Type="nvarchar" Size="30" />
      <Input Name="advcode_new" Type="nvarchar" Size="30" />
      <Input Name="career_id" Type="nvarchar" Size="10" />
      <Input Name="remote_addr" Type="nvarchar" Size="30" />
      <Input Name="shipping_id" Type="nvarchar" Size="10" />
      <Input Name="memo" Type="nvarchar" Size="MAX" />
      <Input Name="date_created" Type="datetime" />
      <Input Name="date_changed" Type="datetime" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
      <Input Name="member_rank_discount_price" Type="decimal" Size="18,3" />
      <Input Name="member_rank_id" Type="nvarchar" Size="30" />
      <Input Name="gift_flg" Type="nvarchar" Size="2" />
      <Input Name="digital_contents_flg" Type="nvarchar" Size="2" />
      <Input Name="shipping_price_separate_estimates_flg" Type="nvarchar" Size="1" />
      <Input Name="order_tax_included_flg" Type="nvarchar" Size="1" />
      <Input Name="order_tax_rate" Type="decimal" />
      <Input Name="order_tax_round_type" Type="nvarchar" Size="20" />
      <Input Name="setpromotion_product_discount_amount" Type="decimal" Size="18,3" />
      <Input Name="setpromotion_shipping_charge_discount_amount" Type="decimal" Size="18,3" />
      <Input Name="setpromotion_payment_charge_discount_amount" Type="decimal" Size="18,3" />
      <Input Name="payment_order_id" Type="nvarchar" Size="50" />
      <Input Name="fixed_purchase_discount_price" Type="decimal" Size="18,3" />
      <Input Name="fixed_purchase_member_discount_amount" Type="decimal" Size="18,3" />
      <Input Name="last_billed_amount" Type="decimal" Size="18,3" />
      <Input Name="last_order_point_use" Type="decimal" />
      <Input Name="last_order_point_use_yen" Type="decimal" Size="18,3" />
      <Input Name="combined_org_order_ids" Type="nvarchar" Size="MAX" />
      <Input Name="management_memo" Type="nvarchar" Size="MAX" />
      <Input Name="shipping_memo" Type="nvarchar" Size="MAX" />
      <Input Name="relation_memo" Type="nvarchar" Size="MAX" />
      <Input Name="regulation_memo" Type="nvarchar" Size="MAX" />
      <Input Name="order_price_regulation" Type="decimal" Size="18,3" />
      <Input Name="last_auth_flg" Type="nvarchar" Size="1" />
      <Input Name="extend_status39" Type="nvarchar" Size="10" />
      <Input Name="order_price_tax" Type="decimal" Size="18,3" />
      <Input Name="order_price_subtotal_tax" Type="decimal" Size="18,3" />
      <Input Name="settlement_rate" Type="decimal" Size="24,12" />
      <Input Name="settlement_amount" Type="decimal" Size="18,3" />
      <Input Name="settlement_currency" Type="nvarchar" Size="3" />
      <Input Name="shipping_tax_rate" Type="decimal" Size="5,2" />
      <Input Name="payment_tax_rate" Type="decimal" Size="5,2" />
      <Input Name="order_count_order" Type="int" />
      <Input Name="invoice_bundle_flg" Type="nvarchar" Size="1" />
      <Input Name="inflow_contents_id" Type="nvarchar" Size="30" />
      <Input Name="inflow_contents_type" Type="nvarchar" Size="20" />
      <Input Name="receipt_flg" Type="nvarchar" Size="1" />
      <Input Name="receipt_address" Type="nvarchar" Size="100" />
      <Input Name="receipt_proviso" Type="nvarchar" Size="100" />
      <Input Name="external_payment_type" Type="nvarchar" Size="20" />
      <Input Name="attribute1" Type="nvarchar" Size="100" />
      <Input Name="attribute2" Type="nvarchar" Size="100" />
      <Input Name="attribute3" Type="nvarchar" Size="100" />
      <Input Name="attribute4" Type="nvarchar" Size="100" />
      <Input Name="attribute5" Type="nvarchar" Size="100" />
      <Input Name="attribute6" Type="nvarchar" Size="100" />
      <Input Name="attribute7" Type="nvarchar" Size="100" />
      <Input Name="attribute8" Type="nvarchar" Size="100" />
      <Input Name="attribute9" Type="nvarchar" Size="100" />
      <Input Name="attribute10" Type="nvarchar" Size="100" />
      <Input Name="subscription_box_course_id" Type="nvarchar" Size="30" />
      <Input Name="subscription_box_fixed_amount" Type="decimal" Size="18,3" />
      <Input Name="order_subscription_box_order_count" Type="int" />
      <Input Name="storepickup_status" Type="nvarchar" Size="30" />
    </Parameter>
  </OrderRegist>

  <!-- 注文者情報追加処理 -->
  <OrderOwnerRegist>
    <Statement>
      <![CDATA[
      INSERT  w2_OrderOwner
              (
                w2_OrderOwner.order_id,
                w2_OrderOwner.owner_kbn,
                w2_OrderOwner.owner_name,
                w2_OrderOwner.owner_name1,
                w2_OrderOwner.owner_name2,
                w2_OrderOwner.owner_name_kana,
                w2_OrderOwner.owner_name_kana1,
                w2_OrderOwner.owner_name_kana2,
                w2_OrderOwner.owner_mail_addr,
                w2_OrderOwner.owner_mail_addr2,
                w2_OrderOwner.owner_zip,
                w2_OrderOwner.owner_addr1,
                w2_OrderOwner.owner_addr2,
                w2_OrderOwner.owner_addr3,
                w2_OrderOwner.owner_addr4,
                w2_OrderOwner.owner_company_name,
                w2_OrderOwner.owner_company_post_name,
                w2_OrderOwner.owner_tel1,
                w2_OrderOwner.owner_sex,
                w2_OrderOwner.owner_birth,
                w2_OrderOwner.date_created,
                w2_OrderOwner.date_changed,
                w2_OrderOwner.access_country_iso_code,
                w2_OrderOwner.disp_language_code,
                w2_OrderOwner.disp_language_locale_id,
                w2_OrderOwner.disp_currency_code,
                w2_OrderOwner.disp_currency_locale_id,
                w2_OrderOwner.owner_addr_country_iso_code,
                w2_OrderOwner.owner_addr_country_name,
                w2_OrderOwner.owner_addr5
              )
      VALUES  (
                @order_id,
                @owner_kbn,
                @owner_name,
                @owner_name1,
                @owner_name2,
                @owner_name_kana,
                @owner_name_kana1,
                @owner_name_kana2,
                @owner_mail_addr,
                @owner_mail_addr2,
                @owner_zip,
                @owner_addr1,
                @owner_addr2,
                @owner_addr3,
                @owner_addr4,
                @owner_company_name,
                @owner_company_post_name,
                @owner_tel1,
                CASE WHEN @owner_sex <> ''
                  THEN @owner_sex
                  ELSE 'UNKNOWN'
                  END,
                @owner_birth,
                @date_created,
                @date_changed,
                @access_country_iso_code,
                @disp_language_code,
                @disp_language_locale_id,
                @disp_currency_code,
                @disp_currency_locale_id,
                @owner_addr_country_iso_code,
                @owner_addr_country_name,
                @owner_addr5
              )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="owner_kbn" Type="nvarchar" Size="10" />
      <Input Name="owner_name" Type="nvarchar" Size="40" />
      <Input Name="owner_name1" Type="nvarchar" Size="20" />
      <Input Name="owner_name2" Type="nvarchar" Size="20" />
      <Input Name="owner_name_kana" Type="nvarchar" Size="60" />
      <Input Name="owner_name_kana1" Type="nvarchar" Size="60" />
      <Input Name="owner_name_kana2" Type="nvarchar" Size="60" />
      <Input Name="owner_mail_addr" Type="nvarchar" Size="256" />
      <Input Name="owner_mail_addr2" Type="nvarchar" Size="256" />
      <Input Name="owner_zip" Type="nvarchar" Size="8" />
      <Input Name="owner_addr1" Type="nvarchar" Size="50" />
      <Input Name="owner_addr2" Type="nvarchar" Size="50" />
      <Input Name="owner_addr3" Type="nvarchar" Size="50" />
      <Input Name="owner_addr4" Type="nvarchar" Size="50" />
      <Input Name="owner_company_name" Type="nvarchar" Size="50" />
      <Input Name="owner_company_post_name" Type="nvarchar" Size="50" />
      <Input Name="owner_tel1" Type="nvarchar" Size="16" />
      <Input Name="owner_sex" Type="nvarchar" Size="10" />
      <Input Name="owner_birth" Type="datetime" />
      <Input Name="date_created" Type="datetime" />
      <Input Name="date_changed" Type="datetime" />
      <Input Name="access_country_iso_code" Type="nvarchar" Size="3" />
      <Input Name="disp_language_code" Type="nvarchar" Size="4" />
      <Input Name="disp_language_locale_id" Type="nvarchar" Size="7" />
      <Input Name="disp_currency_code" Type="nvarchar" Size="4" />
      <Input Name="disp_currency_locale_id" Type="nvarchar" Size="7" />
      <Input Name="owner_addr_country_iso_code" Type="nvarchar" Size="3" />
      <Input Name="owner_addr_country_name" Type="nvarchar" Size="100" />
      <Input Name="owner_addr5" Type="nvarchar" Size="50" />
    </Parameter>
  </OrderOwnerRegist>

  <!-- 注文配送先情報追加処理 -->
  <OrderShippingRegist>
    <Statement>
      <![CDATA[
      INSERT  w2_OrderShipping
              (
                w2_OrderShipping.order_id,
                w2_OrderShipping.order_shipping_no,
                w2_OrderShipping.shipping_name,
                w2_OrderShipping.shipping_name1,
                w2_OrderShipping.shipping_name2,
                w2_OrderShipping.shipping_name_kana,
                w2_OrderShipping.shipping_name_kana1,
                w2_OrderShipping.shipping_name_kana2,
                w2_OrderShipping.shipping_zip,
                w2_OrderShipping.shipping_addr1,
                w2_OrderShipping.shipping_addr2,
                w2_OrderShipping.shipping_addr3,
                w2_OrderShipping.shipping_addr4,
                w2_OrderShipping.shipping_company_name,
                w2_OrderShipping.shipping_company_post_name,
                w2_OrderShipping.shipping_tel1,
                w2_OrderShipping.sender_name,
                w2_OrderShipping.sender_name1,
                w2_OrderShipping.sender_name2,
                w2_OrderShipping.sender_name_kana,
                w2_OrderShipping.sender_name_kana1,
                w2_OrderShipping.sender_name_kana2,
                w2_OrderShipping.sender_zip,
                w2_OrderShipping.sender_addr1,
                w2_OrderShipping.sender_addr2,
                w2_OrderShipping.sender_addr3,
                w2_OrderShipping.sender_addr4,
                w2_OrderShipping.sender_company_name,
                w2_OrderShipping.sender_company_post_name,
                w2_OrderShipping.sender_tel1,
                w2_OrderShipping.shipping_date,
                w2_OrderShipping.shipping_time,
                w2_OrderShipping.wrapping_paper_type,
                w2_OrderShipping.wrapping_paper_name,
                w2_OrderShipping.wrapping_bag_type,
                w2_OrderShipping.date_created,
                w2_OrderShipping.date_changed,
                w2_OrderShipping.another_shipping_flg,
                w2_OrderShipping.shipping_method,
                w2_OrderShipping.delivery_company_id,
                w2_OrderShipping.shipping_country_iso_code,
                w2_OrderShipping.shipping_country_name,
                w2_OrderShipping.shipping_addr5,
                w2_OrderShipping.sender_country_iso_code,
                w2_OrderShipping.sender_country_name,
                w2_OrderShipping.sender_addr5,
                w2_OrderShipping.scheduled_shipping_date,
                w2_OrderShipping.shipping_receiving_store_flg,
                w2_OrderShipping.shipping_receiving_store_id,
                w2_OrderShipping.shipping_receiving_store_type,
                w2_OrderShipping.storepickup_real_shop_id
              )
      VALUES  (
                @order_id,
                @order_shipping_no,
                @shipping_name,
                @shipping_name1,
                @shipping_name2,
                @shipping_name_kana,
                @shipping_name_kana1,
                @shipping_name_kana2,
                @shipping_zip,
                @shipping_addr1,
                @shipping_addr2,
                @shipping_addr3,
                @shipping_addr4,
                @shipping_company_name,
                @shipping_company_post_name,
                @shipping_tel1,
                @sender_name,
                @sender_name1,
                @sender_name2,
                @sender_name_kana,
                @sender_name_kana1,
                @sender_name_kana2,
                @sender_zip,
                @sender_addr1,
                @sender_addr2,
                @sender_addr3,
                @sender_addr4,
                @sender_company_name,
                @sender_company_post_name,
                @sender_tel1,
                @shipping_date,
                @shipping_time,
                @wrapping_paper_type,
                @wrapping_paper_name,
                @wrapping_bag_type,
                @date_created,
                @date_changed,
                @another_shipping_flg,
                @shipping_method,
                @delivery_company_id,
                @shipping_country_iso_code,
                @shipping_country_name,
                @shipping_addr5,
                @sender_country_iso_code,
                @sender_country_name,
                @sender_addr5,
                @scheduled_shipping_date,
                @shipping_receiving_store_flg,
                @shipping_receiving_store_id,
                @shipping_receiving_store_type,
                @storepickup_real_shop_id
              )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="order_shipping_no" Type="int" />
      <Input Name="shipping_name" Type="nvarchar" Size="40" />
      <Input Name="shipping_name1" Type="nvarchar" Size="20" />
      <Input Name="shipping_name2" Type="nvarchar" Size="20" />
      <Input Name="shipping_name_kana" Type="nvarchar" Size="60" />
      <Input Name="shipping_name_kana1" Type="nvarchar" Size="30" />
      <Input Name="shipping_name_kana2" Type="nvarchar" Size="30" />
      <Input Name="shipping_zip" Type="nvarchar" Size="8" />
      <Input Name="shipping_addr1" Type="nvarchar" Size="50" />
      <Input Name="shipping_addr2" Type="nvarchar" Size="50" />
      <Input Name="shipping_addr3" Type="nvarchar" Size="50" />
      <Input Name="shipping_addr4" Type="nvarchar" Size="50" />
      <Input Name="shipping_company_name" Type="nvarchar" Size="50" />
      <Input Name="shipping_company_post_name" Type="nvarchar" Size="50" />
      <Input Name="shipping_tel1" Type="nvarchar" Size="16" />
      <Input Name="sender_name" Type="nvarchar" Size="40" />
      <Input Name="sender_name1" Type="nvarchar" Size="20" />
      <Input Name="sender_name2" Type="nvarchar" Size="20" />
      <Input Name="sender_name_kana" Type="nvarchar" Size="60" />
      <Input Name="sender_name_kana1" Type="nvarchar" Size="30" />
      <Input Name="sender_name_kana2" Type="nvarchar" Size="30" />
      <Input Name="sender_zip" Type="nvarchar" Size="8" />
      <Input Name="sender_addr1" Type="nvarchar" Size="50" />
      <Input Name="sender_addr2" Type="nvarchar" Size="50" />
      <Input Name="sender_addr3" Type="nvarchar" Size="50" />
      <Input Name="sender_addr4" Type="nvarchar" Size="50" />
      <Input Name="sender_company_name" Type="nvarchar" Size="50" />
      <Input Name="sender_company_post_name" Type="nvarchar" Size="50" />
      <Input Name="sender_tel1" Type="nvarchar" Size="16" />
      <Input Name="shipping_date" Type="datetime" />
      <Input Name="shipping_time" Type="nvarchar" Size="30" />
      <Input Name="wrapping_paper_type" Type="nvarchar" Size="50" />
      <Input Name="wrapping_paper_name" Type="nvarchar" Size="200" />
      <Input Name="wrapping_bag_type" Type="nvarchar" Size="50" />
      <Input Name="date_created" Type="datetime" />
      <Input Name="date_changed" Type="datetime" />
      <Input Name="another_shipping_flg" Type="nvarchar" Size="1" />
      <Input Name="shipping_method" Type="nvarchar" Size="10" />
      <Input Name="delivery_company_id" Type="nvarchar" Size="10" />
      <Input Name="shipping_country_iso_code" Type="nvarchar" Size="3" />
      <Input Name="shipping_country_name" Type="nvarchar" Size="100" />
      <Input Name="shipping_addr5" Type="nvarchar" Size="50" />
      <Input Name="sender_country_iso_code" Type="nvarchar" Size="3" />
      <Input Name="sender_country_name" Type="nvarchar" Size="100" />
      <Input Name="sender_addr5" Type="nvarchar" Size="50" />
      <Input Name="scheduled_shipping_date" Type="datetime" />
      <Input Name="shipping_receiving_store_flg" Type="nvarchar" Size="1" />
      <Input Name="shipping_receiving_store_id" Type="nvarchar" Size="20" />
      <Input Name="shipping_receiving_store_type" Type="nvarchar" Size="5" />
      <Input Name="storepickup_real_shop_id" Type="nvarchar" Size="30" />
    </Parameter>
  </OrderShippingRegist>

  <!-- 注文商品情報追加処理 -->
  <OrderItemRegist>
    <Statement>
      <![CDATA[
        INSERT w2_OrderItem
               (
                  w2_OrderItem.order_id,
                  w2_OrderItem.order_item_no,
                  w2_OrderItem.order_shipping_no,
                  w2_OrderItem.shop_id,
                  w2_OrderItem.product_id,
                  w2_OrderItem.variation_id,
                  w2_OrderItem.supplier_id,
                  w2_OrderItem.product_name,
                  w2_OrderItem.product_name_kana,
                  w2_OrderItem.product_price,
                  w2_OrderItem.product_price_org,
                  w2_OrderItem.product_tax_included_flg,
                  w2_OrderItem.product_tax_rate,
                  w2_OrderItem.product_tax_round_type,
                  w2_OrderItem.product_price_pretax,
                  w2_OrderItem.item_quantity,
                  w2_OrderItem.item_quantity_single,
                  w2_OrderItem.item_price,
                  w2_OrderItem.item_price_single,
                  w2_OrderItem.product_set_id,
                  w2_OrderItem.product_set_no,
                  w2_OrderItem.product_set_count,
                  w2_OrderItem.date_created,
                  w2_OrderItem.date_changed,
                  w2_OrderItem.product_option_texts,
                  w2_OrderItem.brand_id,
                  w2_OrderItem.download_url,
                  w2_OrderItem.productsale_id,
                  w2_OrderItem.cooperation_id1,
                  w2_OrderItem.cooperation_id2,
                  w2_OrderItem.cooperation_id3,
                  w2_OrderItem.cooperation_id4,
                  w2_OrderItem.cooperation_id5,
                  w2_OrderItem.cooperation_id6,
                  w2_OrderItem.cooperation_id7,
                  w2_OrderItem.cooperation_id8,
                  w2_OrderItem.cooperation_id9,
                  w2_OrderItem.cooperation_id10,
                  w2_OrderItem.order_setpromotion_no,
                  w2_OrderItem.order_setpromotion_item_no,
                  w2_OrderItem.novelty_id,
                  w2_OrderItem.recommend_id,
                  w2_OrderItem.fixed_purchase_product_flg,
                  w2_OrderItem.product_bundle_id,
                  w2_OrderItem.bundle_item_display_type,
                  w2_OrderItem.product_point,
                  w2_OrderItem.product_point_kbn,
                  w2_OrderItem.limited_payment_ids,
                  w2_OrderItem.plural_shipping_price_free_flg,
                  w2_OrderItem.shipping_size_kbn,
                  w2_OrderItem.item_price_tax,
                  w2_OrderItem.fixed_purchase_discount_value,
                  w2_OrderItem.fixed_purchase_discount_type,
                  w2_OrderItem.item_discounted_price,
                  w2_OrderItem.subscription_box_course_id,
                  w2_OrderItem.subscription_box_fixed_amount
                )
        VALUES  (
                  @order_id,
                  @order_item_no,
                  @order_shipping_no,
                  @shop_id,
                  @product_id,
                  @variation_id,
                  @supplier_id,
                  @product_name,
                  @product_name_kana,
                  @product_price,
                  @product_price_org,
                  @product_tax_included_flg,
                  @product_tax_rate,
                  @product_tax_round_type,
                  @product_price_pretax,
                  @item_quantity,
                  @item_quantity_single,
                  @item_price,
                  @item_price_single,
                  @product_set_id,
                  @product_set_no,
                  @product_set_count,
                  @date_created,
                  @date_changed,
                  @product_option_texts,
                  @brand_id,
                  @download_url,
                  @productsale_id,
                  @cooperation_id1,
                  @cooperation_id2,
                  @cooperation_id3,
                  @cooperation_id4,
                  @cooperation_id5,
                  @cooperation_id6,
                  @cooperation_id7,
                  @cooperation_id8,
                  @cooperation_id9,
                  @cooperation_id10,
                  @order_setpromotion_no,
                  @order_setpromotion_item_no,
                  @novelty_id,
                  @recommend_id,
                  @fixed_purchase_product_flg,
                  @product_bundle_id,
                  @bundle_item_display_type,
                  @product_point,
                  @product_point_kbn,
                  @limited_payment_ids,
                  @plural_shipping_price_free_flg,
                  @shipping_size_kbn,
                  @item_price_tax,
                  @fixed_purchase_discount_value,
                  @fixed_purchase_discount_type,
                  @item_discounted_price,
                  @subscription_box_course_id,
                  @subscription_box_fixed_amount
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="order_item_no" Type="int" />
      <Input Name="order_shipping_no" Type="int" />
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="product_id" Type="nvarchar" Size="30" />
      <Input Name="variation_id" Type="nvarchar" Size="60" />
      <Input Name="supplier_id" Type="nvarchar" Size="20" />
      <Input Name="product_name" Type="nvarchar" Size="200" />
      <Input Name="product_name_kana" Type="nvarchar" Size="200" />
      <Input Name="product_price" Type="decimal" Size="18,3" />
      <Input Name="product_price_org" Type="decimal" Size="18,3" />
      <Input Name="product_tax_included_flg" Type="nvarchar" Size="1" />
      <Input Name="product_tax_rate" Type="decimal" />
      <Input Name="product_tax_round_type" Type="nvarchar" Size="20" />
      <Input Name="product_price_pretax" Type="decimal" Size="18,3" />
      <Input Name="item_quantity" Type="int" />
      <Input Name="item_quantity_single" Type="int" />
      <Input Name="item_price" Type="decimal" Size="18,3" />
      <Input Name="item_price_single" Type="decimal" Size="18,3" />
      <Input Name="product_set_id" Type="nvarchar" Size="30" />
      <Input Name="product_set_no" Type="int" />
      <Input Name="product_set_count" Type="int" />
      <Input Name="date_created" Type="datetime" />
      <Input Name="date_changed" Type="datetime" />
      <Input Name="product_option_texts" Type="nvarchar" Size="max" />
      <Input Name="brand_id" Type="nvarchar" Size="30" />
      <Input Name="download_url" Type="nvarchar" Size="max" />
      <Input Name="productsale_id" Type="nvarchar" Size="10" />
      <Input Name="cooperation_id1" Type="nvarchar" Size="30" />
      <Input Name="cooperation_id2" Type="nvarchar" Size="30" />
      <Input Name="cooperation_id3" Type="nvarchar" Size="30" />
      <Input Name="cooperation_id4" Type="nvarchar" Size="30" />
      <Input Name="cooperation_id5" Type="nvarchar" Size="30" />
      <Input Name="cooperation_id6" Type="nvarchar" Size="50" />
      <Input Name="cooperation_id7" Type="nvarchar" Size="50" />
      <Input Name="cooperation_id8" Type="nvarchar" Size="50" />
      <Input Name="cooperation_id9" Type="nvarchar" Size="50" />
      <Input Name="cooperation_id10" Type="nvarchar" Size="50" />
      <Input Name="order_setpromotion_no" Type="int" />
      <Input Name="order_setpromotion_item_no" Type="int" />
      <Input Name="novelty_id" Type="nvarchar" Size="30" />
      <Input Name="recommend_id" Type="nvarchar" Size="30" />
      <Input Name="fixed_purchase_product_flg" Type="nvarchar" Size="1" />
      <Input Name="product_bundle_id" Type="nvarchar" Size="30" />
      <Input Name="bundle_item_display_type" Type="nvarchar" Size="10" />
      <Input Name="product_point" Type="float" />
      <Input Name="product_point_kbn" Type="nvarchar" Size="1" />
      <Input Name="limited_payment_ids" Type="nvarchar" Size="250" />
      <Input Name="plural_shipping_price_free_flg" Type="nvarchar" Size="1" />
      <Input Name="shipping_size_kbn" Type="nvarchar" Size="4" />
      <Input Name="item_price_tax" Type="decimal" />
      <Input Name="fixed_purchase_discount_value" Type="decimal" />
      <Input Name="fixed_purchase_discount_type" Type="nvarchar" Size="10" />
      <Input Name="item_discounted_price" Type="decimal" Size="18,3" />
      <Input Name="subscription_box_course_id" Type="nvarchar" Size="30" />
      <Input Name="subscription_box_fixed_amount" Type="decimal" Size="18,3" />
    </Parameter>
  </OrderItemRegist>

  <!-- 注文セットプロモーション情報追加処理 -->
  <InsertOrderSetPromotion>
    <Statement>
      <![CDATA[
        INSERT  w2_OrderSetPromotion
                (
                  order_id,
                  order_setpromotion_no,
                  setpromotion_id,
                  setpromotion_name,
                  setpromotion_disp_name,
                  undiscounted_product_subtotal,
                  product_discount_flg,
                  product_discount_amount,
                  shipping_charge_free_flg,
                  shipping_charge_discount_amount,
                  payment_charge_free_flg,
                  payment_charge_discount_amount
                )
        VALUES  (
                  @order_id,
                  @order_setpromotion_no,
                  @setpromotion_id,
                  @setpromotion_name,
                  @setpromotion_disp_name,
                  @undiscounted_product_subtotal,
                  @product_discount_flg,
                  @product_discount_amount,
                  @shipping_charge_free_flg,
                  @shipping_charge_discount_amount,
                  @payment_charge_free_flg,
                  @payment_charge_discount_amount
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="order_setpromotion_no" Type="int" />
      <Input Name="setpromotion_id" Type="nvarchar" Size="10" />
      <Input Name="setpromotion_name" Type="nvarchar" Size="30" />
      <Input Name="setpromotion_disp_name" Type="nvarchar" Size="30" />
      <Input Name="undiscounted_product_subtotal" Type="decimal" Size="18,3" />
      <Input Name="product_discount_flg" Type="nvarchar" Size="1" />
      <Input Name="product_discount_amount" Type="decimal" Size="18,3" />
      <Input Name="shipping_charge_free_flg" Type="nvarchar" Size="1" />
      <Input Name="shipping_charge_discount_amount" Type="decimal" Size="18,3" />
      <Input Name="payment_charge_free_flg" Type="nvarchar" Size="1" />
      <Input Name="payment_charge_discount_amount" Type="decimal" Size="18,3" />
    </Parameter>
  </InsertOrderSetPromotion>
  
  <!-- 注文完了メール情報取得処理(注文商品のみ) -->
  <OrderItemMailTemplete>
    <Statement>
      <![CDATA[
        SELECT  w2_OrderItem.product_id,
                w2_OrderItem.variation_id,
                w2_OrderItem.product_name,
                w2_OrderItem.product_price,
                w2_OrderItem.item_quantity
                w2_OrderItem.item_quantity_single
          FROM  w2_OrderItem
         WHERE  w2_OrderItem.order_id = @order_id
           AND  w2_OrderItem.shop_id = @shop_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </OrderItemMailTemplete>

  <!-- 注文情報削除 -->
  <DeleteOrder>
    <Statement>
      <![CDATA[
        SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
        DELETE  w2_Order
         WHERE  w2_Order.order_id = @order_id
           AND  order_status = 'TMP'
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteOrder>

  <!-- 注文者情報削除 -->
  <DeleteOrderOwner>
    <Statement>
      <![CDATA[
        DELETE  w2_OrderOwner
         WHERE  w2_OrderOwner.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteOrderOwner>

  <!-- 注文配送先情報削除 -->
  <DeleteOrderShipping>
    <Statement>
      <![CDATA[
        DELETE  w2_OrderShipping
         WHERE  w2_OrderShipping.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteOrderShipping>

  <!-- 注文商品情報削除 -->
  <DeleteOrderItem>
    <Statement>
      <![CDATA[
        DELETE  w2_OrderItem
         WHERE  w2_OrderItem.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteOrderItem>

  <!-- 税率毎価格情報削除 -->
  <DeleteOrderPriceByTaxRate>
    <Statement>
      <![CDATA[
        DELETE  w2_OrderPriceByTaxRate
         WHERE  w2_OrderPriceByTaxRate.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </DeleteOrderPriceByTaxRate>

  <!-- 決済手数料取得 -->
  <GetPaymentPrice>
    <Statement>
      <![CDATA[
        SELECT  w2_Payment.shop_id,
                w2_Payment.payment_id,
                w2_Payment.payment_name,
                w2_Payment.payment_price_kbn,
                w2_PaymentPrice.*
          FROM  w2_Payment, w2_PaymentPrice
         WHERE  w2_Payment.shop_id = @shop_id
           AND  w2_Payment.payment_id = @payment_id
           AND  w2_Payment.shop_id = w2_PaymentPrice.shop_id
           AND  w2_Payment.payment_id = w2_PaymentPrice.payment_id
           AND
               (
                  w2_Payment.payment_price_kbn = '0'
                  OR
                  (
                    w2_Payment.payment_price_kbn = '1'
                    AND
                    w2_PaymentPrice.tgt_price_bgn <= @sub_total_price
                    AND
                    w2_PaymentPrice.tgt_price_end >= @sub_total_price
                  )
                )
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="payment_id" Type="nvarchar" Size="10" />
      <Input Name="sub_total_price" Type="decimal" />
    </Parameter>
  </GetPaymentPrice>

  <!-- 決済種別情報取得 -->
  <GetPayment>
    <Statement>
      <![CDATA[
        SELECT  w2_Payment.*
          FROM  w2_Payment
         WHERE  w2_Payment.shop_id = @shop_id
           AND  w2_Payment.payment_id = @payment_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="payment_id" Type="nvarchar" Size="3" />
    </Parameter>
  </GetPayment>

  <!-- Get limited payments from paymentIds -->
  <GetLimitedPayments>
    <Statement>
      <![CDATA[
        SELECT  w2_Payment.*
          FROM  w2_Payment
         WHERE  w2_Payment.shop_id = @shop_id
           AND  payment_id <> 'K90'
           AND  w2_Payment.payment_id IN (@@ payment_ids @@)
           AND  w2_Payment.mobile_disp_flg IN ('0','1') -- PC&モバイル OR PCのみ
           AND  w2_Payment.valid_flg = '1'
      ORDER BY  w2_Payment.display_order ASC, w2_Payment.payment_id ASC
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
    </Parameter>
  </GetLimitedPayments>

  <!-- 決済種別情報一覧取得(店舗内有効なもの、配送種別で許可されているもの) -->
  <GetValidPaymentList>
    <Statement>
      <![CDATA[
        SELECT  w2_Payment.*
          FROM  w2_Payment
         WHERE  w2_Payment.shop_id = @shop_id
           AND  (
                  (((payment_id <> 'K90') AND ((@payment_selection_flg = '0') OR (payment_id IN (@@ payment_ids @@)))) OR (@cart_price_total = 0))
                  AND
                  ((usable_price_min IS NULL) OR (@cart_price_total >= usable_price_min))
                  AND
                  ((usable_price_max IS NULL) OR (@cart_price_total <= usable_price_max))
                  AND
                  ((@restrict_fixedpurchase_payment = '0') OR (payment_id IN (@@ can_fixedpurchase_payment_ids @@)))
                  AND
                  (payment_id NOT LIKE 'M%')
                  AND
                  ('1' = @AmazonPaymentOption OR w2_Payment.payment_id <> @AmazonPaymentID )
                )
           AND  w2_Payment.mobile_disp_flg IN ('0','1') -- PC&モバイル OR PCのみ
           AND  w2_Payment.valid_flg = '1'
      ORDER BY  w2_Payment.display_order ASC, w2_Payment.payment_id ASC           
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="cart_price_total" Type="decimal" />
      <Input Name="payment_selection_flg" Type="nvarchar" Size="1" />
      <Input Name="restrict_fixedpurchase_payment" Type="nvarchar" Size="1" />
      <Input Name="AmazonPaymentOption" Type="nvarchar" Size="1" />
      <Input Name="AmazonPaymentID" Type="nvarchar" Size="10" />
    </Parameter>
  </GetValidPaymentList>

  <!-- 決済種別情報一覧取得(店舗内有効なもの、配送種別で許可されているもの、下限金額チェックなし) -->
  <GetValidPaymentListWithoutCheckUsablePriceMin>
    <Statement>
      <![CDATA[
        SELECT  w2_Payment.*
          FROM  w2_Payment
         WHERE  w2_Payment.shop_id = @shop_id
           AND  (
                  (((payment_id <> 'K90') AND ((@payment_selection_flg = '0') OR (payment_id IN (@@ payment_ids @@)))) OR (@cart_price_total = 0))
                  AND
                  ((usable_price_max IS NULL) OR (@cart_price_total <= usable_price_max))
                  AND
                  ((@restrict_fixedpurchase_payment = '0') OR (payment_id IN (@@ can_fixedpurchase_payment_ids @@)))
                  AND
                  (payment_id NOT LIKE 'M%')
                  AND
                  ('1' = @AmazonPaymentOption OR w2_Payment.payment_id <> @AmazonPaymentID )
                )
           AND  w2_Payment.mobile_disp_flg IN ('0','1') -- PC&モバイル OR PCのみ
           AND  w2_Payment.valid_flg = '1'
      ORDER BY  w2_Payment.display_order ASC, w2_Payment.payment_id ASC
      ]]>
    </Statement>
    <Parameter>
      <Input Name="shop_id" Type="nvarchar" Size="10" />
      <Input Name="cart_price_total" Type="decimal" />
      <Input Name="payment_selection_flg" Type="nvarchar" Size="1" />
      <Input Name="restrict_fixedpurchase_payment" Type="nvarchar" Size="1" />
      <Input Name="AmazonPaymentOption" Type="nvarchar" Size="1" />
      <Input Name="AmazonPaymentID" Type="nvarchar" Size="10" />
    </Parameter>
  </GetValidPaymentListWithoutCheckUsablePriceMin>

  <!-- 注文情報の取得 -->
  <GetOrder>
    <Statement>
      <![CDATA[
        SELECT  w2_Order.*
          FROM  w2_Order
         WHERE  w2_Order.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetOrder>

  <!-- 注文商品情報を取得 -->
  <GetOrderItem>
    <Statement>
      <![CDATA[
        SELECT  w2_OrderItem.*,
                w2_Product.stock_management_kbn
          FROM  w2_OrderItem
                LEFT JOIN w2_Product ON
                (
                  w2_OrderItem.shop_id = w2_Product.shop_id
                  AND
                  w2_OrderItem.product_id = w2_Product.product_id
                )
         WHERE  w2_OrderItem.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetOrderItem>

  <!-- 注文ステータス更新(キャンセル) -->
  <UpdateOrderStatusCancel>
    <Statement>
      <![CDATA[
        UPDATE  w2_Order
           SET  w2_Order.order_status = 'ODR_CNSL',  -- キャンセル
                w2_Order.order_cancel_date = @update_date,
                w2_Order.last_changed = @last_changed,
                w2_Order.date_changed = getdate()
         WHERE  w2_Order.order_id = @order_id
           AND  w2_Order.order_status <> 'ODR_CNSL'  -- キャンセルは対象外（二重キャンセル防止）
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="update_date" Type="datetime" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </UpdateOrderStatusCancel>

  <!-- 購入回数更新(同梱により) -->
  <UpdateUserOrderCount>
    <Statement>
      <![CDATA[
        UPDATE  w2_Order
           SET  w2_Order.order_count_order = @order_count_order,
                w2_Order.last_changed = @last_changed,
                w2_Order.date_changed = getdate()
         WHERE  w2_Order.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
      <Input Name="order_count_order" Type="int" />
    </Parameter>
  </UpdateUserOrderCount>

  <!-- オンライン決済ステータス更新 -->
  <UpdateOnlinePaymentStatus>
    <Statement>
      <![CDATA[
        UPDATE  w2_Order
           SET  w2_Order.online_payment_status = @online_payment_status,
                w2_Order.last_changed = @last_changed,
                w2_Order.date_changed = GETDATE()
         WHERE  w2_Order.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="online_payment_status" Type="nvarchar" Size="2" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </UpdateOnlinePaymentStatus>

  <!-- 注文情報取得(領収書PDF出力用) -->
  <GetOrderItemPdf>
    <Statement>
      <![CDATA[
        /* ダーティリードを許可して共有ロックを掛けなくする */
        SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;  

        SELECT  w2_Order.order_id,
                w2_Order.user_id,
                w2_Order.shop_id,
                w2_Order.supplier_id,
                w2_Order.order_kbn,
                w2_Order.mall_id,
                (CASE
                   WHEN w2_MallCooperationSetting.mall_kbn is null
                   THEN 'OWN_SITE'
                   ELSE w2_MallCooperationSetting.mall_kbn
                 END) AS mall_kbn,
                w2_Order.order_payment_kbn,
                w2_Payment.payment_name,
                w2_Order.order_status,
                w2_Order.order_date,
                w2_Order.order_recognition_date,
                w2_Order.order_stockreserved_status,
                w2_Order.order_stockreserved_date,
                w2_Order.order_shipping_date,
                w2_Order.order_shipped_status,
                w2_Order.order_shipped_date,
                w2_Order.order_delivering_date,
                w2_Order.order_cancel_date,
                w2_Order.order_payment_status,
                w2_Order.order_payment_date,
                w2_Order.demand_status,
                w2_Order.demand_date,
                w2_Order.order_item_count,
                w2_Order.order_product_count,
                w2_Order.order_price_subtotal,
                w2_Order.order_price_tax,
                w2_Order.order_price_subtotal_tax,
                w2_Order.order_price_shipping,
                w2_Order.order_price_exchange,
                w2_Order.order_price_regulation,
                w2_Order.order_price_total,
                w2_Order.order_tax_rate,
                w2_Order.order_point_use,
                w2_Order.order_point_use_yen,
                w2_Order.order_point_add,
                w2_Order.order_coupon_use,
                w2_Order.card_kbn,
                w2_Order.card_tran_id,
                w2_Order.shipping_id,
                w2_Order.extend_status1,
                w2_Order.extend_status2,
                w2_Order.extend_status3,
                w2_Order.extend_status4,
                w2_Order.extend_status5,
                w2_Order.extend_status6,
                w2_Order.extend_status7,
                w2_Order.extend_status8,
                w2_Order.extend_status9,
                w2_Order.extend_status10,
                w2_Order.extend_status11,
                w2_Order.extend_status12,
                w2_Order.extend_status13,
                w2_Order.extend_status14,
                w2_Order.extend_status15,
                w2_Order.extend_status16,
                w2_Order.extend_status17,
                w2_Order.extend_status18,
                w2_Order.extend_status19,
                w2_Order.extend_status20,
                w2_Order.extend_status21,
                w2_Order.extend_status22,
                w2_Order.extend_status23,
                w2_Order.extend_status24,
                w2_Order.extend_status25,
                w2_Order.extend_status26,
                w2_Order.extend_status27,
                w2_Order.extend_status28,
                w2_Order.extend_status29,
                w2_Order.extend_status30,
                w2_Order.extend_status31,
                w2_Order.extend_status32,
                w2_Order.extend_status33,
                w2_Order.extend_status34,
                w2_Order.extend_status35,
                w2_Order.extend_status36,
                w2_Order.extend_status37,
                w2_Order.extend_status38,
                w2_Order.extend_status39,
                w2_Order.extend_status40,
                w2_Order.fixed_purchase_id,
                w2_Order.fixed_purchase_order_count,
                w2_Order.fixed_purchase_shipped_count,
                w2_Order.receipt_output_flg,
                w2_Order.order_discount_set_price,
                w2_ShopShipping.shop_shipping_name,
                w2_DeliveryCompany.shipping_time_id1,
                w2_DeliveryCompany.shipping_time_id2,
                w2_DeliveryCompany.shipping_time_id3,
                w2_DeliveryCompany.shipping_time_id4,
                w2_DeliveryCompany.shipping_time_id5,
                w2_DeliveryCompany.shipping_time_id6,
                w2_DeliveryCompany.shipping_time_id7,
                w2_DeliveryCompany.shipping_time_id8,
                w2_DeliveryCompany.shipping_time_id9,
                w2_DeliveryCompany.shipping_time_id10,
                w2_DeliveryCompany.shipping_time_message1,
                w2_DeliveryCompany.shipping_time_message2,
                w2_DeliveryCompany.shipping_time_message3,
                w2_DeliveryCompany.shipping_time_message4,
                w2_DeliveryCompany.shipping_time_message5,
                w2_DeliveryCompany.shipping_time_message6,
                w2_DeliveryCompany.shipping_time_message7,
                w2_DeliveryCompany.shipping_time_message8,
                w2_DeliveryCompany.shipping_time_message9,
                w2_DeliveryCompany.shipping_time_message10,
                w2_Order.payment_memo,
                w2_Order.management_memo,
                w2_Order.shipping_memo,
                w2_Order.relation_memo,
                w2_Order.memo,
                w2_Order.regulation_memo,
                w2_Order.date_created,
                w2_Order.date_changed,
                w2_Order.member_rank_discount_price,
                w2_OrderOwner.owner_kbn,
                w2_OrderOwner.owner_name,
                w2_OrderOwner.owner_name1,
                w2_OrderOwner.owner_name2,
                w2_OrderOwner.owner_name_kana,
                w2_OrderOwner.owner_name_kana1,
                w2_OrderOwner.owner_name_kana2,
                w2_OrderOwner.owner_mail_addr,
                w2_OrderOwner.owner_mail_addr2,
                w2_OrderOwner.owner_zip,
                w2_OrderOwner.owner_addr1,
                w2_OrderOwner.owner_addr2,
                w2_OrderOwner.owner_addr3,
                w2_OrderOwner.owner_addr4,
                w2_OrderOwner.owner_addr5,
                w2_OrderOwner.owner_addr_country_name,
                w2_OrderOwner.owner_company_name,
                w2_OrderOwner.owner_company_post_name,
                w2_OrderOwner.owner_tel1,
                w2_OrderOwner.owner_sex,
                w2_OrderOwner.owner_birth,
                w2_OrderOwner.disp_language_code,
                w2_OrderOwner.disp_language_locale_id,
                w2_OrderShipping.order_shipping_no,
                w2_OrderShipping.shipping_name,
                w2_OrderShipping.shipping_name1,
                w2_OrderShipping.shipping_name2,
                w2_OrderShipping.shipping_name_kana,
                w2_OrderShipping.shipping_name_kana1,
                w2_OrderShipping.shipping_name_kana2,
                w2_OrderShipping.shipping_zip,
                w2_OrderShipping.shipping_addr1,
                w2_OrderShipping.shipping_addr2,
                w2_OrderShipping.shipping_addr3,
                w2_OrderShipping.shipping_addr4,
                w2_OrderShipping.shipping_addr5,
                w2_OrderShipping.shipping_country_name,
                w2_OrderShipping.shipping_company_name,
                w2_OrderShipping.shipping_company_post_name,
                w2_OrderShipping.shipping_tel1,
                w2_OrderShipping.shipping_date,
                w2_OrderShipping.shipping_time,
                w2_OrderShipping.another_shipping_flg,
                w2_OrderShipping.shipping_method,
                w2_OrderShipping.delivery_company_id,
                w2_OrderShipping.shipping_check_no,
                w2_OrderShipping.scheduled_shipping_date,
                w2_OrderItem.order_item_no,
                (
                  SELECT  COUNT(order_id)
                    FROM  w2_OrderItem
                   WHERE  w2_OrderItem.order_id = w2_Order.order_id
                     AND  w2_OrderItem.order_history_display_type = 'VALID'
                ) AS order_item_rowcount,
                (
                  SELECT  MAX(w2_OrderItem.order_shipping_no)
                    FROM  w2_OrderItem
                   WHERE  w2_OrderItem.order_id = w2_Order.order_id
                   --AND  w2_OrderItem.order_shipping_no = w2_OrderShipping.order_shipping_no
                     AND  w2_OrderItem.order_history_display_type = 'VALID'
                ) AS shipping_no_max,
                (
                  SELECT  SUM(w2_OrderItem.item_price)
                    FROM  w2_OrderItem
                   WHERE  w2_OrderItem.order_id = w2_Order.order_id
                     AND  w2_OrderItem.order_shipping_no = w2_OrderShipping.order_shipping_no
                     AND  w2_OrderItem.order_history_display_type = 'VALID'
                ) AS product_total_price,
                w2_OrderItem.product_id,
                w2_OrderItem.variation_id,
                w2_OrderItem.product_name,
                w2_OrderItem.product_name_kana,
                w2_OrderItem.product_price,
                w2_OrderItem.item_realstock_reserved,
                w2_OrderItem.item_realstock_shipped,
                w2_OrderItem.item_quantity,
                w2_OrderItem.item_price,
                w2_OrderItem.item_price_tax,
                w2_OrderItem.product_tax_rate,
                w2_OrderItem.download_url,
                w2_OrderItem.cooperation_id1,
                w2_OrderItem.cooperation_id2,
                w2_OrderItem.cooperation_id3,
                w2_OrderItem.cooperation_id4,
                w2_OrderItem.cooperation_id5,
                w2_OrderItem.product_option_texts,
                w2_OrderItem.novelty_id,
                w2_OrderItem.item_discounted_price,
                w2_Order.gift_flg,
                w2_Order.digital_contents_flg,
                w2_OrderShipping.sender_name,
                w2_OrderShipping.sender_name1,
                w2_OrderShipping.sender_name2,
                w2_OrderShipping.sender_name_kana,
                w2_OrderShipping.sender_name_kana1,
                w2_OrderShipping.sender_name_kana2,
                w2_OrderShipping.sender_zip,
                w2_OrderShipping.sender_addr1,
                w2_OrderShipping.sender_addr2,
                w2_OrderShipping.sender_addr3,
                w2_OrderShipping.sender_addr4,
                w2_OrderShipping.sender_addr5,
                w2_OrderShipping.sender_country_name,
                w2_OrderShipping.sender_company_name,
                w2_OrderShipping.sender_company_post_name,
                w2_OrderShipping.sender_tel1,
                w2_OrderShipping.wrapping_paper_type,
                w2_OrderShipping.wrapping_paper_name,
                w2_OrderShipping.wrapping_bag_type,
                w2_FixedPurchase.fixed_purchase_id,
                w2_FixedPurchase.fixed_purchase_kbn,
                w2_FixedPurchase.fixed_purchase_setting1,
                w2_FixedPurchase.last_order_date,
                w2_FixedPurchase.order_count,
                w2_FixedPurchase.fixed_purchase_date_bgn,
                w2_FixedPurchase.next_shipping_date,
                w2_FixedPurchase.next_next_shipping_date,
                w2_FixedPurchase.fixed_purchase_management_memo,
                w2_FixedPurchase.next_shipping_use_point,
                w2_Product.name,
                w2_Product.product_type,
                w2_ProductVariation.mall_variation_id1,
                w2_ProductVariation.mall_variation_id2,
                w2_FixedPurchase.fixed_purchase_status,
                (
                  SELECT  SUM(point)
                    FROM  w2_UserPoint
                   WHERE  w2_UserPoint.user_id = w2_User.user_id
                     AND  w2_UserPoint.point_type = '01'
                ) AS user_point,
                (
                  SELECT SUM(point)
                    FROM w2_UserPoint
                   WHERE w2_UserPoint.user_id = w2_User.user_id
                     AND w2_UserPoint.point_type = '00'
                ) AS user_point_temp,
                w2_Order.setpromotion_product_discount_amount,
                w2_Order.setpromotion_shipping_charge_discount_amount,
                w2_Order.setpromotion_payment_charge_discount_amount,
                w2_OrderSetPromotion.setpromotion_name,
                w2_OrderSetPromotion.setpromotion_disp_name,
                w2_OrderSetPromotion.setpromotion_id,
                w2_User.user_memo,
                w2_Order.fixed_purchase_discount_price,
                w2_Order.fixed_purchase_member_discount_amount,
                w2_Order.receipt_address,
                w2_Order.receipt_proviso,
                -- ↓軽減税率用↓
                ISNULL(PriceTotalByTax.[8.00], 0) AS price_total_8,
                ISNULL(PriceTotalByTax.[10.00], 0) AS price_total_10,
                ISNULL(TaxPriceByRate.[8.00], 0) AS tax_price_8,
                ISNULL(TaxPriceByRate.[10.00], 0) AS tax_price_10
                -- ↑軽減税率用↑
          FROM  w2_Order
                INNER JOIN w2_OrderOwner ON
                (
                  w2_Order.order_id = w2_OrderOwner.order_id
                )
                INNER JOIN w2_OrderShipping ON
                (
                  w2_Order.order_id = w2_OrderShipping.order_id
                )
                INNER JOIN w2_OrderItem ON
                (
                  w2_OrderShipping.order_id = w2_OrderItem.order_id
                  AND
                  w2_OrderShipping.order_shipping_no = w2_OrderItem.order_shipping_no
                  And
                  w2_OrderItem.order_history_display_type = 'VALID'
                )
                LEFT JOIN w2_Payment ON
                (
                  w2_Order.shop_id = w2_Payment.shop_id
                  AND
                  w2_Order.order_payment_kbn = w2_Payment.payment_id
                )
                LEFT JOIN w2_ShopShipping ON
                (
                  w2_Order.shop_id = w2_ShopShipping.shop_id
                  AND
                  w2_Order.shipping_id = w2_ShopShipping.shipping_id
                )
                LEFT JOIN w2_MallCooperationSetting ON
                (
                  w2_Order.shop_id = w2_MallCooperationSetting.shop_id
                  AND
                  w2_Order.mall_id = w2_MallCooperationSetting.mall_id
                )
                LEFT JOIN w2_Product ON
                (
                  w2_OrderItem.shop_id = w2_Product.shop_id 
                  AND
                  w2_OrderItem.product_id = w2_Product.product_id
                )
                LEFT JOIN w2_ProductVariation ON
                (
                  w2_OrderItem.shop_id = w2_ProductVariation.shop_id 
                  AND
                  w2_OrderItem.product_id = w2_ProductVariation.product_id
                  AND
                  w2_OrderItem.variation_id = w2_ProductVariation.variation_id
                )
                INNER JOIN w2_User ON
                (
                  w2_Order.user_id = w2_User.user_id
                )
                LEFT JOIN w2_FixedPurchase ON
                (
                  w2_Order.fixed_purchase_id = w2_FixedPurchase.fixed_purchase_id
                )
                LEFT JOIN w2_OrderSetPromotion ON
                (
                  w2_OrderItem.order_id = w2_OrderSetPromotion.order_id
                  AND
                  w2_OrderItem.order_setpromotion_no = w2_OrderSetPromotion.order_setpromotion_no
                )
                LEFT JOIN w2_DeliveryCompany ON
                (
                  w2_OrderShipping.delivery_company_id = w2_DeliveryCompany.delivery_company_id
                )
                INNER JOIN
                (
                  SELECT  *
                    FROM
                        (
                        SELECT  order_id,
                                price_total_by_rate,
                                key_tax_rate
                          FROM  w2_OrderPriceByTaxRate
                        ) AS o
                   PIVOT (SUM(price_total_by_rate) FOR key_tax_rate IN ([8.00], [10.00])) AS pvsub
                ) AS PriceTotalByTax
                ON
                (
                  w2_Order.order_id = PriceTotalByTax.order_id
                )
                INNER JOIN
                (
                  SELECT  *
                    FROM
                        (
                        SELECT  order_id,
                                tax_price_by_rate,
                                key_tax_rate
                          FROM  w2_OrderPriceByTaxRate
                        ) AS o
                   PIVOT (SUM(tax_price_by_rate) FOR key_tax_rate IN ([8.00], [10.00])) AS pvsub
                ) AS TaxPriceByRate
                ON
                (
                  w2_Order.order_id = TaxPriceByRate.order_id
                )
          WHERE w2_Order.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
    </Parameter>
  </GetOrderItemPdf>

  <!-- 注文ステータス更新(注文済み) -->
  <UpdateOrderStatusComp>
    <Statement>
      <![CDATA[
        UPDATE  w2_Order
           SET  w2_Order. order_status = 'ODR',  -- 注文済み
                w2_Order.last_changed = @last_changed,
                w2_Order.date_changed = getdate()
         WHERE  w2_Order.order_id = @order_id
      ]]>
    </Statement>
    <Parameter>
      <Input Name="order_id" Type="nvarchar" Size="30" />
      <Input Name="last_changed" Type="nvarchar" Size="20" />
    </Parameter>
  </UpdateOrderStatusComp>

</Order>

