<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : 商品ランキング分析系SQLステートメントXML(ProductSearchAnalysis.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright W2 Co.,Ltd. 2009 All Rights Reserved.
=========================================================================================================
-->
<ProductSearchAnalysis>
  <!-- 検索ワード -->
  <GetSearchWordNum>
    <Statement>
      <![CDATA[
      DECLARE @summary_kbn nvarchar(30)

      -- PC限定
      IF @access_kbn = '1'
        BEGIN
          SET @summary_kbn = 'pct_searchword_pc'
        END
      -- モバイル限定
      ELSE IF @access_kbn = '2'
        BEGIN
          SET @summary_kbn = 'pct_searchword_mob'
        END
      -- スマートフォン限定
      ELSE IF @access_kbn = '3'
        BEGIN
          SET @summary_kbn = 'pct_searchword_sp'
        END
      -- 全体
      ELSE
        BEGIN
          SET @summary_kbn = 'pct_searchword'
        END
      
      SELECT  tgt_year,
              tgt_month,
              tgt_day,
              value_name,
              counts
        FROM  w2_DispSummaryAnalysis
       WHERE  dept_id = @dept_id
         AND  tgt_year = @tgt_year
         AND  tgt_month = @tgt_month
         AND  value_name = @value_name
         AND  summary_kbn = @summary_kbn -- 集計区分：検索ワード
      ]]>
    </Statement>
    <Parameter>
      <Input Name="dept_id" Type="nvarchar" Size="30" />
      <Input Name="tgt_year" Type="nvarchar" Size="4" />
      <Input Name="tgt_month" Type="nvarchar" Size="2" />
      <Input Name="value_name" Type="nvarchar" Size="500" />
      <Input Name="access_kbn" Type="nvarchar" Size="10" />
    </Parameter>
  </GetSearchWordNum>

  <!-- 商品販売数 -->
  <GetBuyCountNum>
    <Statement>
      <![CDATA[
      DECLARE @summary_kbn nvarchar(30)

      -- PC限定
      IF @access_kbn = '1'
        BEGIN
          SET @summary_kbn = 'pct_buycount_pc'
        END
      -- モバイル限定
      ELSE IF @access_kbn = '2'
        BEGIN
          SET @summary_kbn = 'pct_buycount_mob'
        END
      -- スマートフォン限定
      ELSE IF @access_kbn = '3'
        BEGIN
          SET @summary_kbn = 'pct_buycount_sp'
        END
      -- 全体
      ELSE
        BEGIN
          SET @summary_kbn = 'pct_buycount'
        END
      
      SELECT  tgt_year,
              tgt_month,
              tgt_day,
              counts
        FROM  w2_DispSummaryAnalysis
       WHERE  dept_id = @dept_id
         AND  tgt_year = @tgt_year
         AND  tgt_month = @tgt_month
         AND  reserved7 = @reserved7
         AND  summary_kbn = @summary_kbn -- 集計区分：商品販売数
      ]]>
    </Statement>
    <Parameter>
      <Input Name="dept_id" Type="nvarchar" Size="30" />
      <Input Name="tgt_year" Type="nvarchar" Size="4" />
      <Input Name="tgt_month" Type="nvarchar" Size="2" />
      <Input Name="reserved7" Type="nvarchar" Size="50" />
      <Input Name="access_kbn" Type="nvarchar" Size="10" />
    </Parameter>
  </GetBuyCountNum>

  <!-- 商品販売金額 -->
  <GetBuyPriceNum>
    <Statement>
      <![CDATA[
      DECLARE @summary_kbn nvarchar(30)

      -- PC限定
      IF @access_kbn = '1'
        BEGIN
          SET @summary_kbn = 'pct_buyprice_pc'
        END
      -- モバイル限定
      ELSE IF @access_kbn = '2'
        BEGIN
          SET @summary_kbn = 'pct_buyprice_mob'
        END
      -- スマートフォン限定
      ELSE IF @access_kbn = '3'
        BEGIN
          SET @summary_kbn = 'pct_buyprice_sp'
        END
      -- 全体
      ELSE
        BEGIN
          SET @summary_kbn = 'pct_buyprice'
        END
      
      SELECT  tgt_year,
              tgt_month,
              tgt_day,
              price,
              price_tax
        FROM  w2_DispSummaryAnalysis
       WHERE  dept_id = @dept_id
         AND  tgt_year = @tgt_year
         AND  tgt_month = @tgt_month
         AND  reserved7 = @reserved7
         AND  summary_kbn = @summary_kbn -- 集計区分：商品販売金額
      ]]>
    </Statement>
    <Parameter>
      <Input Name="dept_id" Type="nvarchar" Size="30" />
      <Input Name="tgt_year" Type="nvarchar" Size="4" />
      <Input Name="tgt_month" Type="nvarchar" Size="2" />
      <Input Name="reserved7" Type="nvarchar" Size="50" />
      <Input Name="access_kbn" Type="nvarchar" Size="10" />
    </Parameter>
  </GetBuyPriceNum> 

</ProductSearchAnalysis>