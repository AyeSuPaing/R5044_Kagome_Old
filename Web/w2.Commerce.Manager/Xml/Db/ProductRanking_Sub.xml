<?xml version="1.0" encoding="utf-8" ?>
<!--
=========================================================================================================
  Module      : 商品ランキング系SQLサブステートメントXML(ProductRanking_Sub.xml)
 ･･･････････････････････････････････････････････････････････････････････････････････････････････････････
  Copyright   : Copyright W2 Co.,Ltd. 2010 All Rights Reserved.
=========================================================================================================
-->
<ProductRanking_Sub>

  <!-- 商品ランキング情報一覧取得用WHERE文 -->
  <PRODUCTRANKING_SEARCH_WHERE>
    <Statement>
      <![CDATA[
         WHERE  w2_ProductRanking.shop_id = @shop_id 
           AND  (
                  (@ranking_id_like_escaped = '' OR w2_ProductRanking.ranking_id like @ranking_id_like_escaped + '%' ESCAPE '#') -- 商品ランキングID
                  AND 
                  (@total_type = '' OR w2_ProductRanking.total_type = @total_type) -- 集計タイプ
                  AND
                  (@valid_flg = '' OR w2_ProductRanking.valid_flg = @valid_flg) -- 有効フラグ
                )
      ]]>
    </Statement>
  </PRODUCTRANKING_SEARCH_WHERE>

  <!-- 商品ランキング情報一覧取得用ORDER_BY -->
  <PRODUCTRANKING_SEARCH_ORDER_BY>
    <Statement>
      <![CDATA[
        ORDER BY
          CASE @sort_kbn
            WHEN  0 THEN w2_ProductRanking.ranking_id
            ELSE '1'
          END 
          ASC, 
          CASE @sort_kbn
            WHEN  2 THEN w2_ProductRanking.date_created
            WHEN  4 THEN w2_ProductRanking.date_changed
            ELSE NULL
          END 
          ASC, 
          CASE @sort_kbn
            WHEN  1 THEN w2_ProductRanking.ranking_id
            ELSE '1'
          END 
          DESC, 
          CASE @sort_kbn
            WHEN  3 THEN w2_ProductRanking.date_created
            WHEN  5 THEN w2_ProductRanking.date_changed
            ELSE NULL
          END 
          DESC,
          -- 常に一定の結果セットを得るため、主キー（昇順）ソート
          w2_ProductRanking.shop_id ASC, w2_ProductRanking.ranking_id ASC
      ]]>
    </Statement>
  </PRODUCTRANKING_SEARCH_ORDER_BY>
</ProductRanking_Sub>
